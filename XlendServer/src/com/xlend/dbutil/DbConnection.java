package com.xlend.dbutil;

import com.xlend.XlendServer;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.rmi.RemoteException;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Locale;
import java.util.Properties;

/**
 *
 * @author Nick Mukhin
 */
public class DbConnection {

    private static final int DB_VERSION_ID = 25;
    public static final String DB_VERSION = "0.25";
    private static boolean isFirstTime = true;
    private static Properties props = new Properties();
    private static String[] createLocalDBsqls = loadDDLscript("crebas_hsqldb.sql");
    private static String[] fixLocalDBsqls = new String[]{
        "update dbversion set version_id = " + DB_VERSION_ID + ",version = '" + DB_VERSION + "'",
        //        //version 0.2->0.3
        //        "alter table xclient add description varchar(255)",
        //        "create cached table xcontract"
        //        + "("
        //        + "    xcontract_id   int generated by default as identity (start with 1),"
        //        + "    contractref    varchar(32) not null,"
        //        + "    description    varchar(255),"
        //        + "    xclient_id     int not null,"
        //        + "    picture_id     int,"
        //        + "    constraint xcontract_pk primary key (xcontract_id),"
        //        + "    constraint xcontract_xclient_fk foreign key (xclient_id) references xclient,"
        //        + "    constraint xcontact_picture_fk foreign key (picture_id) references picture"
        //        + ")",
        //        //version 0.3->0.4
        //        "alter table xcontract drop constraint xcontact_picture_fk",
        //        "alter table xcontract drop picture_id",
        //        "create cached table xcontractpage"
        //        + "("
        //        + "    xcontractpage_id   int generated by default as identity (start with 1),"
        //        + "    xcontract_id       int not null,"
        //        + "    pagenum            int,"
        //        + "    description        varchar(64),"
        //        + "    pagescan           other,"
        //        + "    constraint xcontractpage_pk primary key (xcontractpage_id),"
        //        + "    constraint xcontractpage_xcontract_fk foreign key (xcontract_id) references xcontract on delete cascade"
        //        + ")",
        //        //version 0.4->0.5
        //        "create cached table xquotation ("
        //        + "    xquotation_id      int generated by default as identity (start with 1),"
        //        + "    xclient_id         int not null,"
        //        + "    rfcnumber          varchar(32) not null,"
        //        + "    constraint xquotation_pk primary key (xquotation_id),"
        //        + "    constraint xquotation_xclient_fk foreign key (xclient_id) references xclient"
        //        + ")",
        //        "create cached table xquotationpage ("
        //        + "    xquotationpage_id  int generated by default as identity (start with 1),"
        //        + "    xquotation_id      int not null,"
        //        + "    pagenum            int,"
        //        + "    description        varchar(64),"
        //        + "    pagescan           other,"
        //        + "    constraint xquotationpage_pk primary key (xquotationpage_id),"
        //        + "    constraint xquotationpage_xquotation_fk foreign key (xquotation_id) references xquotation on delete cascade"
        //        + ")",
        //        "create cached table xorder ("
        //        + "    xorder_id          int generated by default as identity (start with 1),"
        //        + "    xclient_id         int not null,"
        //        + "    xcontract_id       int,"
        //        + "    xquotation_id      int,"
        //        + "    vatnumber          varchar(32) not null,"
        //        + "    regnumber          varchar(32) not null,"
        //        + "    ordernumber        varchar(32) not null,"
        //        + "    orderdate          date not null,"
        //        + "    contactname        varchar(255),"
        //        + "    contactphone       varchar(32),"
        //        + "    contactfax         varchar(32),"
        //        + "    deliveryaddress    varchar(255) not null,"
        //        + "    invoiceaddress     varchar(255) not null,"
        //        + "    constraint xorder_pk primary key (xorder_id),"
        //        + "    constraint xorder_xclient_fk foreign key (xclient_id) references xclient,"
        //        + "    constraint xorder_xquotation_fk  foreign key (xquotation_id) references xquotation,"
        //        + "    constraint xorder_xcontract foreign key (xcontract_id) references xcontract"
        //        + ")",
        //        "create cached table xorderitem ("
        //        + "    xorderitem_id     int generated by default as identity (start with 1),"
        //        + "    xorder_id         int not null,"
        //        + "    itemnumber        varchar(16) not null,"
        //        + "    materialnumber    varchar(16),"
        //        + "    description       varchar(255) not null,"
        //        + "    quantity          int not null,"
        //        + "    measureitem       varchar(8),"
        //        + "    priceperone       decimal(10,2) not null,"
        //        + "    constraint xorderitem_pk primary key (xorderitem_id),"
        //        + "    constraint xoreritem_xorder_fk foreign key (xorder_id) references xorder on delete cascade"
        //        + ")",
        //        "create cached table xorderpage ("
        //        + "     xorderpage_id     int generated by default as identity (start with 1),"
        //        + "     xorder_id         int not null,"
        //        + "     pagenum           int,"
        //        + "     description       varchar(64),"
        //        + "     pagescan          other,"
        //        + "     constraint xorderpage_pk primary key (xorderpage_id),"
        //        + "     constraint xorderpage_xorder_fk foreign key (xorder_id) references xorder on delete cascade"
        //        + ")",
        //        //version 0.5->0.6
        //        "alter table xorderitem add machinetype varchar(64)",
        //        "alter table xorderitem add deliveryreq date",
        //        "alter table xorderitem add delivery date",
        //        //version 0.6->0.7
        //        "alter table xsite add xorder_id int",
        //        "alter table xsite add constraint xsite_xorder_fk foreign key (xorder_id) references xorder on delete cascade",
        //        "alter table xcontractpage add fileextension varchar(8)",
        //        "alter table xorderpage add fileextension varchar(8)",
        //        "alter table xquotationpage add fileextension varchar(8)",
        //        //version 0.7->0.8
        //        "create cached table xposition"
        //        + "("
        //        + "    xposition_id    int generated by default as identity (start with 1),"
        //        + "    pos        varchar(64) not null,"
        //        + "    constraint xposition_pk primary key (xposition_id)"
        //        + ")",
        //        "create cached table xemployee"
        //        + "("
        //        + "    xemployee_id    int generated by default as identity (start with 1),"
        //        + "    clock_num       varchar(8)  not null,"
        //        + "    first_name      varchar(16) not null,"
        //        + "    sur_name        varchar(16) not null,"
        //        + "    nick_name       varchar(16) not null,"
        //        + "    id_num          varchar(16) not null,"
        //        + "    clocksheets     smallint default 1,"
        //        + "    phone0_num      varchar(16) not null,"
        //        + "    phone1_num      varchar(16) not null,"
        //        + "    phone2_num      varchar(16) not null,"
        //        + "    relation1       varchar(16),"
        //        + "    relation2       varchar(16),"
        //        + "    address         varchar(128),"
        //        + "    contract_len    int not null,"
        //        + "    contract_start  date not null,"
        //        + "    contract_end    date,"
        //        + "    rate            double not null,"
        //        + "    xposition_id    int,"
        //        + "    taxnum          varchar(32),
        //        + "    photo           other,"
        //        + "    photo2          other,"
        //        + "    deceased        bit,"
        //        + "    dismissed       bit,"
        //        + "    absconded       bit,"
        //        + "    resigned        bit,"
        //        + "    deceased_date   date,"
        //        + "    dismissed_date  date,"
        //        + "    absconded_date  date,"
        //        + "    resigned_date   date,"
        //        + "    wage_category   int,"
        //        + "    bank_name       varchar(128),"
        //        + "    bank_account    varchar(32),"
        //        + "    branch_code_name varchar(32),"
        //        + "    constraint xemployee_pk primary key (xemployee_id),"
        //        + "    constraint xemployeer_xposition_fk foreign key (xposition_id) references xposition"
        //        + ")",
        //        "create cached table xtimesheet"
        //        + "("
        //        + "    xtimesheet_id int generated by default as identity (start with 1),"
        //        + "    xemployee_id  int not null,"
        //        + "    xclient_id    int not null,"
        //        + "    xsite_id      int not null,"
        //        + "    weekend       date,"
        //        + "    clocksheet    smallint default 1,"
        //        + "    image         other,"
        //        + "    constraint xtimesheet_pk primary key (xtimesheet_id),"
        //        + "    constraint xtimesheet_xemployee_fk foreign key (xemployee_id) references xemployee on delete cascade,"
        //        + "    constraint xtimesheet_xclient_fk foreign key (xclient_id) references xclient,"
        //        + "    constraint xtimesheet_xsite_fk foreign key (xsite_id) references xsite"
        //        + ")",
        //        "create cached table xwage"
        //        + "("
        //        + "    xwage_id       int generated by default as identity (start with 1),"
        //        + "    xtimesheet_id  int not null,"
        //        + "    day            date,"
        //        + "    normaltime     double,"
        //        + "    overtime       double,"
        //        + "    doubletime     double,"
        //        + "    stoppeddetails varchar(128),"
        //        + "    constraint xwage_pk primary key (xwage_id),"
        //        + "    constraint xwage_xtimesheet_fk foreign key (xtimesheet_id) references xtimesheet on delete cascade"
        //        + ")",
        //        //version 0.8->0.9
        //        "alter table xquotation add received date",
        //        "alter table xquotation add deadline date",
        //        "alter table xquotation add responded date",
        //        "alter table xquotation add responsedby varchar(12)",
        //        "alter table xquotation add responsecmnt varchar(128)",
        //        "alter table xquotation add responder_id  int",
        //        "alter table xquotation add responsedoc other",
        //        "alter table xquotation add constraint xquotation_profile_fk foreign key (responder_id) references userprofile",
        //        "alter table xorder drop vatnumber",
        //        "alter table xorder drop regnumber",
        //        "alter table xtimesheet drop constraint xtimesheet_xclient_fk",
        //        "alter table xtimesheet drop xclient_id",
        //        "alter table xtimesheet add xorder_id int",
        //        "alter table xtimesheet add constraint xtimesheet_xorder_fk foreign key (xorder_id) references xorder",
        //        "alter table xwage add deduction double",
        //        //version 09->10
        //        "alter table xorderitem drop constraint XORDERITEM_XMACHTYPE_FK",
        //        "alter table xmachtype drop constraint xmachtype_xmachtype_fk",
        //        "alter table xmachine drop constraint xmachine_xmachtype_fk",
        //        "alter table xmachine drop constraint xmachine_xmachtype_fk2",
        //        "delete from xmachtype",
        //        "drop table xlicensestat",
        //        "drop table xmachine",
        //        "drop table xmachtype",
        //        "create cached table xmachtype"
        //        + "("
        //        + "    xmachtype_id     int generated by default as identity (start with 1),"
        //        + "    machtype         varchar(32) not null,"
        //        + "    parenttype_id    int,"
        //        + "    classify         char(1),"
        //        + "    constraint xmachtype_pk primary key (xmachtype_id),"
        //        + "    constraint xmachtype_xmachtype_fk foreign key (parenttype_id) references xmachtype"
        //        + ")",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(1,'Buldozer',null,'M')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(2,'TLB',null,'M')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(3,'Roller',null,'M')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(4,'Excavator',null,'M')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(5,'Bobcat',null,'M')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(6,'Grader',null,'M')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(7,'Other',null,'M')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(8,'6M TIPPER',null,'T')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(9,'10M TIPPER',null,'T')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(10,'WATERCARTS',null,'T')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(11,'TATA NOVUS 5542',null,'L')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(12,'FORD LOUISVILLE',null,'L')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(13,'INTERNATIONAL S-LINE',null,'L')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(14,'SINGLE AXLE MERCEDES',null,'L')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(15,'VOLVO F12',null,'L')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(16,'PICK-UP',null,'P')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(17,'BREAK-DOWN',null,'P')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(18,'PANELVAN',null,'P')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(19,'BUS',null,'P')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(20,'MINI BUS',null,'P')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(21,'LAND ROVER',null,'V')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(22,'SEDAN',null,'V')",
        //        "insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(23,'BIKE',null,'V')",
        //        "insert into xmachtype (machtype,parenttype_id) values('D31', 1)",
        //        "insert into xmachtype (machtype,parenttype_id) values('D41', 1)",
        //        "insert into xmachtype (machtype,parenttype_id) values('D4H', 1)",
        //        "insert into xmachtype (machtype,parenttype_id) values('D65', 1)",
        //        "insert into xmachtype (machtype,parenttype_id) values('D6H', 1)",
        //        "insert into xmachtype (machtype,parenttype_id) values('D6R', 1)",
        //        "insert into xmachtype (machtype,parenttype_id) values('428B 4X4',2)",
        //        "insert into xmachtype (machtype,parenttype_id) values('428B 4X2',2)",
        //        "insert into xmachtype (machtype,parenttype_id) values('428C 4X4',2)",
        //        "insert into xmachtype (machtype,parenttype_id) values('428C 4X2',2)",
        //        "insert into xmachtype (machtype,parenttype_id) values('428E 4X4',2)",
        //        "insert into xmachtype (machtype,parenttype_id) values('428E HAMMER',2)",
        //        "insert into xmachtype (machtype,parenttype_id) values('428E 4X2',2)",
        //        "insert into xmachtype (machtype,parenttype_id) values('422E 4X4',2)",
        //        "insert into xmachtype (machtype,parenttype_id) values('422E 4X2',2)",
        //        "insert into xmachtype (machtype,parenttype_id) values('434E 4X4',2)",
        //        "insert into xmachtype (machtype,parenttype_id) values('434E HAMMER',2)",
        //        "insert into xmachtype (machtype,parenttype_id) values('PADFOOT ROLLER',3)",
        //        "insert into xmachtype (machtype,parenttype_id) values('SMOOTH DRUM ROLLER',3)",
        //        "insert into xmachtype (machtype,parenttype_id) values('2.5TON ROLLER',3)",
        //        "insert into xmachtype (machtype,parenttype_id) values('PNEUMATIC ROLLER',3)",
        //        "insert into xmachtype (machtype,parenttype_id) values('320 CAT',4)",
        //        "insert into xmachtype (machtype,parenttype_id) values('322 CAT',4)",
        //        "insert into xmachtype (machtype,parenttype_id) values('322 CAT HAMMER',4)",
        //        "insert into xmachtype (machtype,parenttype_id) values('325 CAT',4)",
        //        "insert into xmachtype (machtype,parenttype_id) values('330 CAT',4)",
        //        "insert into xmachtype (machtype,parenttype_id) values('PC200',4)",
        //        "insert into xmachtype (machtype,parenttype_id) values('PC300',4)",
        //        "insert into xmachtype (machtype,parenttype_id) values('216B',5)",
        //        "insert into xmachtype (machtype,parenttype_id) values('EXCAVATING ATTACHMENT',5)",
        //        "insert into xmachtype (machtype,parenttype_id) values('BROOM ATTACHMENT',5)",
        //        "insert into xmachtype (machtype,parenttype_id) values('HAMMER ATTACHMENT',5)",
        //        "insert into xmachtype (machtype,parenttype_id) values('140H',6)",
        //        "insert into xmachtype (machtype,parenttype_id) values('140G',6)",
        //        "insert into xmachtype (machtype,parenttype_id) values('TRACTOR WITH SLASHER',7)",
        //        "insert into xmachtype (machtype,parenttype_id) values('TELESCOPIC HANDLER',7)",
        //        "insert into xmachtype (machtype,parenttype_id) values('BELL 225A LOGGER',7)",
        //        "insert into xmachtype (machtype,parenttype_id) values('MERCEDES 1414',8)",
        //        "insert into xmachtype (machtype,parenttype_id) values('TOYOTA 6000',8)",
        //        "insert into xmachtype (machtype,parenttype_id) values('TATA LPT',8)",
        //        "insert into xmachtype (machtype,parenttype_id) values('MERCEDES ATEGO',8)",
        //        "insert into xmachtype (machtype,parenttype_id) values('OTHER',8)",
        //        "insert into xmachtype (machtype,parenttype_id) values('TATA NOVUS 3434',9)",
        //        "insert into xmachtype (machtype,parenttype_id) values('MITCHUBISHI FUSO',9)",
        //        "insert into xmachtype (machtype,parenttype_id) values('MERCEDES ACTROS',9)",
        //        "insert into xmachtype (machtype,parenttype_id) values('SAMAG',9)",
        //        "insert into xmachtype (machtype,parenttype_id) values('BLUNT NOSE MERCEDES',9)",
        //        "insert into xmachtype (machtype,parenttype_id) values('NISSAN CW46',9)",
        //        "insert into xmachtype (machtype,parenttype_id) values('OTHER',9)",
        //        "insert into xmachtype (machtype,parenttype_id) values('6000L',10)",
        //        "insert into xmachtype (machtype,parenttype_id) values('12000L',10)",
        //        "insert into xmachtype (machtype,parenttype_id) values('HILUX',16)",
        //        "insert into xmachtype (machtype,parenttype_id) values('HILUX HIGH RIDER',16)",
        //        "insert into xmachtype (machtype,parenttype_id) values('NISSAN 1400',16)",
        //        "insert into xmachtype (machtype,parenttype_id) values('OTHER',16)",
        //        "insert into xmachtype (machtype,parenttype_id) values('TOYOTA DYNA',17)",
        //        "insert into xmachtype (machtype,parenttype_id) values('MERCEDES VITO',18)",
        //        "insert into xmachtype (machtype,parenttype_id) values('MERCEDES SPRINTER',18)",
        //        "insert into xmachtype (machtype,parenttype_id) values('9 SEATER SPRINTER',19)",
        //        "insert into xmachtype (machtype,parenttype_id) values('12 SEATER SPRINTER',19)",
        //        "insert into xmachtype (machtype,parenttype_id) values('VOLKSWAGEN MICROBUS',20)",
        //        "insert into xmachtype (machtype,parenttype_id) values('KIA PREGIO',20)",
        //        "insert into xmachtype (machtype,parenttype_id) values('DEFENDER 100',21)",
        //        "insert into xmachtype (machtype,parenttype_id) values('DEFENDER 110',21)",
        //        "insert into xmachtype (machtype,parenttype_id) values('DISCOVERY 2',21)",
        //        "insert into xmachtype (machtype,parenttype_id) values('BMW 318',22)",
        //        "insert into xmachtype (machtype,parenttype_id) values('BMW 328',22)",
        //        "insert into xmachtype (machtype,parenttype_id) values('MERCEDES C220',22)",
        //        "insert into xmachtype (machtype,parenttype_id) values('MERCEDES C280',22)",
        //        "insert into xmachtype (machtype,parenttype_id) values('AUDI',22)",
        //        "insert into xmachtype (machtype,parenttype_id) values('HONDA',23)",
        //        "insert into xmachtype (machtype,parenttype_id) values('BMW',23)",
        //        "delete from xmachtype where machtype='Kamatsu FEL'",
        //        "delete from xmachtype where machtype='FrontEnd Loader' and classify='M'",
        //        "delete from xmachtype where machtype='Case TLB'",
        //        "drop index xmachtype_uniq if exists",
        //        "insert into xmachtype(machtype,parenttype_id,classify) values('FrontEnd Loader',null,'M')",
        //        "insert into xmachtype(machtype,parenttype_id) select 'Kamatsu FEL',xmachtype_id from xmachtype where machtype='FrontEnd Loader'",
        //        "insert into xmachtype(machtype,parenttype_id) select 'Case TLB',xmachtype_id from xmachtype where machtype='TLB'",
        //        "alter table xorderitem add constraint XORDERITEM_XMACHTYPE_FK foreign key (xmachtype_id) references xmachtype",
        //        "alter table xmachtype add constraint xmachtype_xmachtype_fk foreign key (parenttype_id) references xmachtype",
        //        "create cached table xmachine"
        //        + "("
        //        + "    xmachine_id     int generated by default as identity (start with 1),"
        //        + "    tmvnr           varchar(3) not null,"
        //        + "    xmachtype_id    int not null,"
        //        + "    xmachtype2_id   int,"
        //        + "    reg_nr          varchar(16),"
        //        + "    expdate         date,"
        //        + "    vehicleid_nr    varchar(16),"
        //        + "    engine_nr       varchar(16),"
        //        + "    chassis_nr      varchar(32),"
        //        + "    classify        char(1),"
        //        + "    insurance_nr    varchar(16),"
        //        + "    insurance_tp    varchar(16),"
        //        + "    insurance_amt   int,"
        //        + "    deposit_amt     int,"
        //        + "    contract_fee    int,"
        //        + "    monthly_pay     int,"
        //        + "    paystart        date,"
        //        + "    payend          date,"
        //        + "    photo           other,"
        //        + "    constraint xmachine_pk primary key (xmachine_id),"
        //        + "    constraint xmachine_xmachtype_fk foreign key (xmachtype_id) references xmachtype,"
        //        + "    constraint xmachine_xmachtype_fk2 foreign key (xmachtype2_id) references xmachtype"
        //        + ")",
        //        "alter table xmachine add constraint xmachine_xmachtype_fk foreign key (xmachtype_id) references xmachtype",
        //        "alter table xmachine add constraint xmachine_xmachtype_fk2 foreign key (xmachtype2_id) references xmachtype",
        //version 09->10
        //                "alter table xorderitem drop materialnumber",
        //                "alter table xorderitem drop description",
        //                "alter table xorderitem drop machinetype",
        //                "alter table xorderitem add xmachtype_id int",
        //                "alter table xorderitem add totalvalue decimal(10,2)",
        //                "alter table xorderitem add constraint xorderitem_xmachtype_fk foreign key (xmachtype_id) references xmachtype",
        //                "drop table xmachineonsite ",
        //                "create table xmachineonsite "
        //                + "("
        //                + "    xmachineonsate_id int generated by default as identity (start with 1),"
        //                + "    xsite_id          int not null,"
        //                + "    xmachine_id       int not null,"
        //                + "    xemployee_id      int,"
        //                + "    estdate           date not null,"
        //                + "    deestdate         date,"
        //                + "    constraint xmachineonsite_pk primary key (xmachineonsate_id),"
        //                + "    constraint xmachineonsite_xmachine_fk foreign key (xmachine_id) references xmachine on delete cascade,"
        //                + "    constraint xmachineonsite_xsite_fk foreign key (xsite_id) references xsite,"
        //                + "    constraint xmachineonsite_xemployee_fk foreign key (xemployee_id) references xemployee "
        //                + ")",
        //                "create cached table xsupplier"
        //                + "("
        //                + "    xsupplier_id     int generated by default as identity (start with 1),"
        //                + "    companyname      varchar(64)  not null,"
        //                + "    contactperson    varchar(64),"
        //                + "    productdesc      varchar(128) not null,"
        //                + "    phone            varchar(64),"
        //                + "    fax              varchar(32),"
        //                + "    cell             varchar(64),"
        //                + "    email            varchar(128),"
        //                + "    vatnr            varchar(32),"
        //                + "    company_regnr    varchar(32),"
        //                + "    address          varchar(255),"
        //                + "    constraint xsupplier_pk primary key (xsupplier_id)"
        //                + ")",
        //                "create cached table xpaidmethod"
        //                + "("
        //                + "    xpaidmethod_id   int generated by default as identity (start with 1),"
        //                + "    method           varchar(32) not null,"
        //                + "    constraint xpaidmethod_pk primary key (xpaidmethod_id)"
        //                + ")",
        //                "insert into xpaidmethod values (1, 'Cash Purchase')",
        //                "insert into xpaidmethod values (2, 'Cheque')",
        //                "insert into xpaidmethod values (3, 'Electronic Bank Transfer')",
        //                "insert into xpaidmethod values (4, 'On Account (not Paid)')",
        //                "insert into xpaidmethod values (5, 'On Account (Paid)')",
        //                "create cached table xdieselpchs"
        //                + "("
        //                + "    xdieselpchs_id   int generated by default as identity (start with 1),"
        //                + "    xsupplier_id     int not null,"
        //                + "    purchased        date not null,"
        //                + "    authorizer_id    int,"
        //                + "    amount_liters    int not null,"
        //                + "    amount_rands     int not null,"
        //                + "    paidby_id        int,"
        //                + "    xpaidmethod_id   int not null,"
        //                + "    constraint xdieselpchs_pk primary key (xdieselpchs_id),"
        //                + "    constraint xdieselpchs_xsupplier_fk foreign key (xsupplier_id) references xsupplier,"
        //                + "    constraint xdieselpchs_xemployee_fk foreign key (authorizer_id) references xemployee,"
        //                + "    constraint xdieselpchs_xemployee_fk2 foreign key (paidby_id) references xemployee,"
        //                + "    constraint xdieselpchs_xpaidmethod_fk foreign key (xpaidmethod_id) references xpaidmethod"
        //                + ")",
        //                "create cached table xdieselcard"
        //                + "("
        //                + "    xdieselcard_id    int generated by default as identity (start with 1),"
        //                + "    carddate          date not null,"
        //                + "    xmachine_id       int not null,"
        //                + "    operator_id       int not null,"
        //                + "    xsite_id          int not null,"
        //                + "    amount_liters     int,"
        //                + "    personiss_id      int,"
        //                + "    constraint xdieselcard_pk primary key (xdieselcard_id),"
        //                + "    constraint xdieselcard_xmachine_fk foreign key (xmachine_id) references xmachine,"
        //                + "    constraint xdieselcard_xemployee_fk foreign key (operator_id) references xemployee,"
        //                + "    constraint xdieselcard_xsite_fk foreign key (xsite_id) references xsite,"
        //                + "    constraint xdieselcard_xemployee_fk2 foreign key (personiss_id) references xemployee"
        //                + ")",
        //                "create cached table xconsume"
        //                + "("
        //                + "    xconsume_id       int generated by default as identity (start with 1),"
        //                + "    xsupplier_id      int not null,"
        //                + "    xmachine_id       int not null,"
        //                + "    requester_id      int not null,"
        //                + "    invoicedate       date,"
        //                +"     invoicenumber     varchar(16),"
        //                + "    authorizer_id     int,"
        //                + "    collector_id      int,"
        //                + "    description       varchar(255),"
        //                + "    partnumber        varchar(32),"
        //                + "    amount_liters     int,"
        //                + "    amount_rands      int,"
        //                + "    payer_id          int,"
        //                + "    xpaidmethod_id    int not null,"
        //                + "    chequenumber      varchar(32),"
        //                + "    constraint xconsume_pk primary key (xconsume_id),"
        //                + "    constraint xconsume_xsupplier_fk foreign key (xsupplier_id) references xsupplier,"
        //                + "    constraint xconsume_xmachine_fk foreign key (xmachine_id) references xmachine,"
        //                + "    constraint xconsume_xemployee_fk foreign key (requester_id) references xemployee,"
        //                + "    constraint xconsume_xemployee_fk2 foreign key (authorizer_id) references xemployee,"
        //                + "    constraint xconsume_xemployee_fk3 foreign key (collector_id) references xemployee, "
        //                + "    constraint xconsume_xemployee_fk4 foreign key (payer_id) references xemployee,"
        //                + "    constraint xconsume_xpaidmethod_fk foreign key (xpaidmethod_id) references xpaidmethod"
        //                + ")",
        //                "alter table xconsume add invoicenumber varchar(16)",
        //                "alter table xemployee add photo2 other",
        //                "alter table xemployee add taxnum varchar(32)",
        //        //version 12->13
        //                "create cached table xwagesum"
        //                + "("
        //                + "    xwagesum_id int generated by default as identity (start with 1),"
        //                + "    weekend     date,"
        //                + "    constraint xwagesum_pk primary key (xwagesum_id)"
        //                + ")",
        //                "create cached table xwagesumitem"
        //                + "("
        //                + "    xwagesumitem_id int generated by default as identity (start with 1),"
        //                + "    xwagesum_id     int,"
        //                + "    xemployee_id    int not null,"
        //                + "    xtimesheet_id   int,"
        //                + "    weeklywage      int,"
        //                + "    normaltime      double,"
        //                + "    overtime        double,"
        //                + "    doubletime      double,"
        //                + "    constraint xwagesumitem_pk primary key (xwagesumitem_id),"
        //                + "    constraint xwagesumitem_xwagesum_fk foreign key (xwagesum_id) references xwagesum on delete cascade,"
        //                + "    constraint xwagesumitem_xemployee_fk foreign key (xemployee_id) references xemployee on delete cascade,"
        //                + "    constraint xwagesumitem_xtimesheet_fk foreign key (xtimesheet_id) references xtimesheet"
        //                + ")",
        //        //version 13->14
        //                "alter table xsupplier add banking varchar(255)",
        ////                "create cached table xcreditor"
        ////                + "("
        ////                + "    xcreditor_id     int generated by default as identity (start with 1),"
        ////                + "    xsupplier_id     int not null,"
        ////                + "    xconsume_id      int,"
        ////                + "    accnum           varchar(16),"
        ////                + "    invoiceammount   decimal(10,2),"
        ////                + "    paid             bit,"
        ////                + "    outstandammount  decimal(10,2),"
        ////                + "    paidfrom         int,"
        ////                + "    payday           date,"
        ////                + "    constraint xcreditors_pk primary key (xcreditor_id),"
        ////                + "    constraint xcreditor_xsupplier_fk foreign key (xsupplier_id) references xsupplier,"
        ////                + "    constraint xcreditor_xconsume_fk foreign key (xconsume_id) references xconsume"
        ////                + ")",
        //        //version 14->15
        //                "alter table xcreditor alter column invoiceammount rename to _inv",
        //                "alter table xcreditor add invoiceammount decimal(10,2)",
        //                "update xcreditor set invoiceammount=_inv",
        //                "alter table xcreditor drop _inv",
        //                "alter table xcreditor drop outstandammount",
        //                "alter table xcreditor add purchased date",
        //                "create table cbitems("
        //                + "cbitem_id     int generated by default as identity (start with 1),"
        //                + "name varchar(12) not null, "
        //                + "id int not null, "
        //                + "val varchar(32), constraint cbitems_pk primary key (cbitem_id)"
        //                + ")",
        //                "insert into cbitems values(1,'paidfrom',0,'--Unknown--')",
        //                "insert into cbitems values(2,'paidfrom',1,'TO MACHINE AND TRUCK')",
        //                "insert into cbitems values(3,'paidfrom',2,'TO TRUCK SALES')",
        //                "insert into cbitems values(4,'paidfrom',3,'T&F CONSTRUCTION')",
        //                "insert into cbitems values(5,'paidfrom',4,'XLEND PLANT')",
        //                "insert into cbitems values(6,'paidfrom',5,'EACSA')",
        //                "alter table xemployee add deceased bit",
        //                "alter table xemployee add dismissed bit",
        //                "alter table xemployee add absconded bit",
        ////                "drop table usersheet",
        ////                "drop table sheet",
        //                "drop table dual",
        //                "create table dual (dummy char(1))",
        //                "insert into dual values('A')",
        //                "create cached table sheet"
        //                + "("
        //                + "    sheet_id  int generated by default as identity (start with 1),"
        //                + "    sheetname varchar(32) not null,"
        //                + "    classname varchar(64),"
        //                + "    parent_id int,"
        //                + "    constraint sheet_pk primary key (sheet_id)"
        //                + ")",
        "create cached table usersheet"
        + "("
        + "    usersheet_id int generated by default as identity (start with 1),"
        + "    profile_id   int not null,"
        + "    sheet_id     int not null,"
        + "    constraint usersheet_pk primary key (usersheet_id),"
        + "    constraint usersheet_sheet_fk foreign key (sheet_id) references sheet on delete cascade,"
        + "    constraint usersheet_user_fk foreign key (profile_id) references userprofile on delete cascade"
        + ")",
        //        //version 15->16
        //        "create cached table xfuel"
        //        + "("
        //        + "    xfuel_id     int generated by default as identity (start with 1),"
        //        + "    fdate        date,"
        //        + "    ammount      decimal(10,2),"
        //        + "    liters       int,"
        //        + "    xsite_id     int,"
        //        + "    issuedby_id  int,"
        //        + "    issuedto_id  int,"
        //        + "    xsupplier_id int,"
        //        + "    iscache      bit,"
        //        + "    constraint xfuel_id primary key (xfuel_id),"
        //        + "    constraint xfuel_xsite_fk foreign key (xsite_id) references xsite,"
        //        + "    constraint xfuel_xemployee_fk foreign key (issuedby_id) references xemployee,"
        //        + "    constraint xfuel_xemployee_fk2 foreign key (issuedto_id) references xemployee,"
        //        + "    constraint xfuel_xsupplier_fk foreign key (xsupplier_id) references xsupplier"
        //        + ")",
        //        "alter table xfuel add liters int",
        //        "update sheet set sheetname='Creditors' where sheetname='Credotors'",
        //        //"drop table xpayment",
        //        "create cached table xpayment"
        //        + "("
        //        + "    xpayment_id  int generated by default as identity (start with 1),"
        //        + "    xsupplier_id int not null,"
        //        + "    paydate      date not null,"
        //        + "    ammount      decimal(10,2) not null,"
        //        + "    paidfrom     int not null,"
        //        + "    paydby_id    int,"
        //        + "    constraint xpayment_pk primary key (xpayment_id),"
        //        + "    constraint xpayment_xsupplier_fk foreign key (xsupplier_id) references xsupplier,"
        //        + "    constraint xpayment_xemployee_fk foreign key (paydby_id) references xemployee"
        //        + ")",
        //        "alter table xconsume alter column amount_rands rename to _amt",
        //        "alter table xconsume add amount_rands decimal(10,2)",
        //        "update xconsume set amount_rands=_amt",
        //        "alter table xconsume drop _amt",
        //        "alter table xdieselpchs alter column amount_rands rename to _amt",
        //        "alter table xdieselpchs add amount_rands decimal(10,2)",
        //        "update xdieselpchs set amount_rands=_amt",
        //        "alter table xdieselpchs drop _amt",
        //        "alter table xemployee add deceased_date date",
        //        "alter table xemployee add dismissed_date date",
        //        "alter table xemployee add absconded_date date",
        //        "alter table xemployee add resigned_date date",
        //        "alter table xemployee add resigned bit",
        //        "alter table xconsume add accnum varchar(16)",
        //        "alter table xbreakdown add invoicenumber varchar(16)",
        //        "alter table xbreakdown add amount decimal(10,2)",
        //        "alter table xbreakdown drop description",
        //        "update sheet set sheetname='Payments' where sheetname='Creditors'",
        //        //version 16->17
        //        "create cached table xlowbed"
        //        + "("
        //        + "    xlowbed_id      int generated by default as identity (start with 1),"
        //        + "    xmachine_id     int not null,"
        //        + "    driver_id       int,"
        //        + "    assistant_id    int,"
        //        + "    constraint xlowbed_pk primary key (xlowbed_id),"
        //        + "    constraint xlowbed_xmachine_fk foreign key (xmachine_id) references xmachine,"
        //        + "    constraint xlowbed_xemployee_fk foreign key (driver_id) references xemployee,"
        //        + "    constraint xlowbed_xemployee_fk2 foreign key (assistant_id) references xemployee"
        //        + ")",
        //        "create cached table xtrip"
        //        + "("
        //        + "    xtrip_id      int generated by default as identity (start with 1),"
        //        + "    xlowbed_id    int not null,"
        //        + "    trip_date     date not null,"
        //        + "    fromsite_id   int not null,"
        //        + "    tosite_id     int not null,"
        //        + "    loaded        bit,"
        //        + "    distance      int not null,"
        //        + "    driver_id     int,"
        //        + "    assistant_id  int,"
        //        + "    trip_type     int,"
        //        + "    constraint xtrip_pk primary key (xtrip_id),"
        //        + "    constraint xtrip_xlowbed_fk foreign key (xlowbed_id) references xlowbed on delete cascade,"
        //        + "    constraint xtrip_xsite_fk foreign key (fromsite_id) references xsite,"
        //        + "    constraint xtrip_xsite_fk2 foreign key (tosite_id) references xsite,"
        //        + "    constraint xtrip_xemployee_fk foreign key (driver_id) references xemployee,"
        //        + "    constraint xtrip_xemployee_fk2 foreign key (assistant_id) references xemployee"
        //        + ")",
        ////        "drop table xtripestablish",
        //        "create cached table xtripestablish"
        //        + "("
        //        + "    xtripestablish_id int generated by default as identity (start with 1),"
        //        + "    xtrip_id          int not null,"
        //        + "    xsite_id          int not null,"
        //        + "    xmachine_id       int not null,"
        //        + "    distance_empty    int not null,"
        //        + "    distance_loaded   int,"
        //        + "    constraint xtripestablish_pk primary key (xtripestablish_id),"
        //        + "    constraint xtripestablish_xtrip_fk foreign key (xtrip_id) references xtrip on delete cascade,"
        //        + "    constraint xtripestablish_xsite_fk foreign key (xsite_id) references xsite,"
        //        + "    constraint xtripestablish_xmachine_fk foreign key (xmachine_id) references xmachine"
        //        + ")",
        //        "create cached table xtripmoving"
        //        + "("
        //        + "    xtripmoving_id  int generated by default as identity (start with 1),"
        //        + "    xtrip_id        int not null,"
        //        + "    xmachine_id     int not null,"
        //        + "    fromsite_id     int not null,"
        //        + "    tosite_id       int not null,"
        //        + "    distance_empty  int not null,"
        //        + "    distance_loaded int not null,"
        //        + "    constraint xtripmoving_pk primary key (xtripmoving_id),"
        //        + "    constraint xtripmoving_xtrip_fk foreign key (xtrip_id) references xtrip on delete cascade,"
        //        + "    constraint xtripmoving_xmachine_fk foreign key (xmachine_id) references xmachine,"
        //        + "    constraint xtripmoving_xsite_fk foreign key (fromsite_id) references xsite,"
        //        + "    constraint xtripmoving_xsite_fk2 foreign key (tosite_id) references xsite"
        //        + ")",
        //        "create cached table xtripexchange"
        //        + "("
        //        + "    xtripexchange_id  int generated by default as identity (start with 1),"
        //        + "    xtrip_id          int not null,"
        //        + "    xsite_id          int not null,"
        //        + "    machine_id        int not null,"
        //        + "    withmachine_id    int not null,"
        //        + "    distance_empty    int not null,"
        //        + "    distance_loaded   int not null,"
        //        + "    constraint xtripexchange_pk primary key (xtripexchange_id),"
        //        + "    constraint xtripexchange_xsite_fk foreign key (xsite_id) references xsite,"
        //        + "    constraint xtripexchange_xmachine_fk foreign key (machine_id) references xmachine,"
        //        + "    constraint xtripexchange_xmachine_fk2 foreign key (withmachine_id) references xmachine"
        //        + ")"
        //       ,"drop table xcreditor"
        //version 17->18
        //        "create cached table xabsenteeism"
        //        + "("
        //        + "    xabsenteeism_id int generated by default as identity (start with 1),"
        //        + "    xemployee_id    int not null,"
        //        + "    absentdate      date not null,"
        //        + "    xsite_id        int not null,"
        //        + "    xmachine_id     int not null,"
        //        + "    standing        bit,"
        //        + "    reportedby_id   int not null,"
        //        + "    reportedto_id   int not null,"
        //        + "    notcommunicated bit,"
        //        + "    permgranted     bit,"
        //        + "    grantedby_id    int,"
        //        + "    reason          varchar(1024),"
        //        + "    medical_cond    bit,"
        //        + "    funeral         bit,"
        //        + "    family_problem  bit,"
        //        + "    in_jail         bit,"
        //        + "    pdp_expired     bit,"
        //        + "    license_problem bit,"
        //        + "    ppe_safety      bit,"
        //        + "    wage_dispute    bit,"
        //        + "    drunk_on_site   bit,"
        //        + "    work_accident   bit,"
        //        + "    no_reason       bit,"
        //        + "    medical_cert    bit,"
        //        + "    death_cert      bit,"
        //        + "    constraint xabsenteeism_pk primary key (xabsenteeism_id),"
        //        + "    constraint xabsenteeism_xemployee_fk foreign key (xemployee_id) references xemployee on delete cascade,"
        //        + "    constraint xabsenteeism_xsite_fk foreign key (xsite_id) references xsite on delete cascade,"
        //        + "    constraint xabsenteeism_xmachine_fk foreign key (xmachine_id) references xmachine,"
        //        + "    constraint xabsenteeism_xemployee_fk2 foreign key (reportedby_id) references xemployee on delete cascade,"
        //        + "    constraint xabsenteeism_xemployee_fk3 foreign key (reportedto_id) references xemployee on delete cascade,"
        //        + "    constraint xabsenteeism_xemployee_fk4 foreign key (grantedby_id) references xemployee on delete cascade"
        //        + ")",
        //        "create cached table xissuing"
        //        + "("
        //        + "    xissuing_id int generated by default as identity (start with 1),"
        //        + "    issueddate  date not null,"
        //        + "    operator_id int not null,"
        //        + "    xmachine_id int not null,"
        //        + "    xsite_id    int not null,"
        //        + "    time1_start  time,"
        //        + "    time1_end    time,"
        //        + "    time2_start  time,"
        //        + "    time2_end    time,"
        //        + "    time3_start  time,"
        //        + "    time3_end    time,"
        //        + "    time4_start  time,"
        //        + "    time4_end    time,"
        //        + "    time5_start  time,"
        //        + "    time5_end    time,"
        //        + "    time6_start  time,"
        //        + "    time6_end    time,"
        //        + "    time7_start  time,"
        //        + "    time7_end    time,"
        //        + "    hours1_start int,"
        //        + "    hours1_end   int,"
        //        + "    hours2_start int,"
        //        + "    hours2_end   int,"
        //        + "    hours3_start int,"
        //        + "    hours3_end   int,"
        //        + "    hours4_start int,"
        //        + "    hours4_end   int,"
        //        + "    hours5_start int,"
        //        + "    hours5_end   int,"
        //        + "    hours6_start int,"
        //        + "    hours6_end   int,"
        //        + "    hours7_start int,"
        //        + "    hours7_end   int,"
        //        + "    liters1_start int,"
        //        + "    liters1_end   int,"
        //        + "    liters2_start int,"
        //        + "    liters2_end   int,"
        //        + "    liters3_start int,"
        //        + "    liters3_end   int,"
        //        + "    liters4_start int,"
        //        + "    liters4_end   int,"
        //        + "    liters5_start int,"
        //        + "    liters5_end   int,"
        //        + "    liters6_start int,"
        //        + "    liters6_end   int,"
        //        + "    liters7_start int,"
        //        + "    liters7_end   int,"
        //        + "    issuedby1_start int,"
        //        + "    issuedby1_end   int,"
        //        + "    issuedby2_start int,"
        //        + "    issuedby2_end   int,"
        //        + "    issuedby3_start int,"
        //        + "    issuedby3_end   int,"
        //        + "    issuedby4_start int,"
        //        + "    issuedby4_end   int,"
        //        + "    issuedby5_start int,"
        //        + "    issuedby5_end   int,"
        //        + "    issuedby6_start int,"
        //        + "    issuedby6_end   int,"
        //        + "    issuedby7_start int,"
        //        + "    issuedby7_end   int,"
        //        + "    constraint xissuing_pk primary key (xissuing_id),"
        //        + "    constraint xissuing_xemployee_fk foreign key (operator_id) references xemployee,"
        //        + "    constraint xissuing_xmachine_fk foreign key (xmachine_id) references xmachine,"
        //        + "    constraint xissuing_xsite_fk foreign key (xsite_id) references xsite,"
        //        + "    constraint xissuing_xemployee_fk1s foreign key (issuedby1_start) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk1e foreign key (issuedby1_end) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk2s foreign key (issuedby2_start) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk2e foreign key (issuedby2_end) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk3s foreign key (issuedby3_start) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk3e foreign key (issuedby3_end) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk4s foreign key (issuedby4_start) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk4e foreign key (issuedby4_end) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk5s foreign key (issuedby5_start) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk5e foreign key (issuedby5_end) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk6s foreign key (issuedby6_start) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk6e foreign key (issuedby6_end) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk7s foreign key (issuedby7_start) references xemployee,"
        //        + "    constraint xissuing_xemployee_fk7e foreign key (issuedby7_end) references xemployee"
        //        + ")",
        //        //        "drop table xtripsheetpart","drop table xtripsheet",
        //        "create cached table xtripsheet"
        //        + "("
        //        + "    xtripsheet_id  int generated by default as identity (start with 1),"
        //        + "    tripdate       date not null,"
        //        + "    xlowbed_id     int not null,"
        //        + "    driver_id      int not null,"
        //        + "    authorized_id  int not null,"
        //        + "    constraint xtripsheet_pk primary key (xtripsheet_id),"
        //        + "    constraint xtripsheet_xmachine_fk foreign key (xlowbed_id) references xlowbed,"
        //        + "    constraint xtripsheet_xemployee_fk foreign key (driver_id) references xemployee,"
        //        + "    constraint xtripsheet_xemployee_fk2 foreign key (authorized_id) references xemployee"
        //        + ")",
        //        "create cached table xtripsheetpart"
        //        + "("
        //        + "    xtripsheetpart_id int generated by default as identity (start with 1),"
        //        + "    xtripsheet_id    int not null,"
        //        + "    partdate          date not null,"
        //        + "    fromsite_id       int not null,"
        //        + "    tosite_id         int not null,"
        //        + "    loaded1_id        int,"
        //        + "    loaded2_id        int,"
        //        + "    isempty           bit,"
        //        + "    timestart         time,"
        //        + "    timeend           time,"
        //        + "    kilimeters        int,"
        //        + "    assistant_id      int,"
        //        + "    constraint xtripsheetpart_fk primary key (xtripsheetpart_id),"
        //        + "    constraint xtripsheetpart_xtripsheet_fk foreign key (xtripsheet_id) references xtripsheet on delete cascade,"
        //        + "    constraint xtripsheetpart_xsite_fk foreign key (fromsite_id) references xsite,"
        //        + "    constraint xtripsheetpart_xsite_fk2 foreign key (tosite_id) references xsite,"
        //        + "    constraint xtripsheetpart_xmachine_fk foreign key (loaded1_id) references xmachine,"
        //        + "    constraint xtripsheetpart_xmachine_fk2 foreign key (loaded2_id) references xmachine,"
        //        + "    constraint xtripsheetpart_xemployee_fk foreign key (assistant_id) references xemployee"
        //        + ")",
        //        //        "drop table xaccounts",
        //        "create cached table xaccounts"
        //        + "("
        //        + "    xaccount_id       int generated by default as identity (start with 1),"
        //        + "    accname           varchar(32) not null,"
        //        + "    accnumber         varchar(12) not null,"
        //        + "    bank              varchar(32) not null,"
        //        + "    branch            varchar(32) not null,"
        //        + "    constraint xaccount_pk primary key (xaccount_id)"
        //        + ")",
        //        //        "drop table xsitediary",
        //        //        "drop table xsitediarypart",
        //        "create cached table xsitediary"
        //        + "("
        //        + "    xsitediary_id    int generated by default as identity (start with 1),"
        //        + "    diarydate        date not null,"
        //        + "    xsite_id         int not null,"
        //        + "    manager_id       int not null,"
        //        + "    site_foreman     varchar(32),"
        //        + "    site_number      varchar(32),"
        //        + "    constraint xsitediary_pk primary key (xsitediary_id),"
        //        + "    constraint xsitediary_xsite_fk foreign key (xsite_id) references xsite,"
        //        + "    constraint xsitediary_xemployee_fk foreign key (manager_id) references xemployee"
        //        + ")",
        //        //        "drop table xsitediarypart",
        //        "create cached table xsitediarypart"
        //        + "("
        //        + "    xsitediarypart_id  int generated by default as identity (start with 1),"
        //        + "    xsitediary_id      int not null,"
        //        + "    partdate           date not null,"
        //        + "    xmachine_id        int not null,"
        //        + "    hrs_worked         int not null,"
        //        + "    hrs_standing       int not null,"
        //        + "    operator_id        int not null,"
        //        + "    comments           varchar(1024),"
        //        + "    constraint xsitediarypart_pk primary key (xsitediarypart_id),"
        //        + "    constraint xsitediarypart_xsitediary_fk foreign key (xsitediary_id) references xsitediary on delete cascade,"
        //        + "    constraint xsitediarypart_xmachine_fk foreign key (xmachine_id) references xmachine,"
        //        + "    constraint xsitediarypart_xemployee_fk foreign key (operator_id) references xemployee"
        //        + ")",
        //        //version 18->19
        //        "create cached table xappforleave"
        //        + "("
        //        + "    xappforleave_id  int generated by default as identity (start with 1),"
        //        + "    appdate          date not null,"
        //        + "    applicant_id     int not null,"
        //        + "    is_sickleave     bit,"
        //        + "    is_annualleave   bit,"
        //        + "    is_specialleave  bit,"
        //        + "    is_unpaidleave   bit,"
        //        + "    fromdate         date,"
        //        + "    todate           date,"
        //        + "    days             int,"
        //        + "    is_signed        bit,"
        //        + "    is_approved      bit,"
        //        + "    approvedby_id    int,"
        //        + "    remarks          varchar(1024),"
        //        + "    constraint xappforleave_pk primary key (xappforleave_id),"
        //        + "    constraint xappforleave_xemployee_fk foreign key (applicant_id) references xemployee,"
        //        + "    constraint xappforleave_xemployee_fk2 foreign key (approvedby_id) references xemployee"
        //        + ")",
        //        "alter table xappforleave ALTER COLUMN unpaidleave rename to is_unpaidleave",
        //        "create cached table xbankbalance"
        //        + "("
        //        + "    xbankbalance_id  int generated by default as identity (start with 1),"
        //        + "    balancedate      timestamp not null,"
        //        + "    totalvalue       decimal(12,2),"
        //        + "    constraint xbankbalance_pk primary key (xbankbalance_id)"
        //        + ")",
        //        "create cached table xbankbalancepart"
        //        + "("
        //        + "   xbankbalancepart_id int generated by default as identity (start with 1),"
        //        + "   xbankbalance_id     int not null,"
        //        + "   xaccount_id         int not null,"
        //        + "   total               decimal(10,2),"
        //        + "   constraint xbankbalancepart_pk primary key (xbankbalancepart_id),"
        //        + "   constraint xbankbalancepart_xbankbalance_fk foreign key (xbankbalance_id) references xbankbalance on delete cascade,"
        //        + "   constraint xbankbalancepart_xaccounts_fk foreign key (xaccount_id) references xaccounts"
        //        + ")",
        //        "create cached table xloans"
        //        + "("
        //        + "    xloans_id        int generated by default as identity (start with 1),"
        //        + "    loandate         date not null,"
        //        + "    is_loan          bit,"
        //        + "    is_advance       bit,"
        //        + "    is_transport     bit,"
        //        + "    requestedby_id   int not null,"
        //        + "    authorizedby_id  int,"
        //        + "    issueddate       date,"
        //        + "    deductstartdate  date,"
        //        + "    amount           decimal(10,2) not null,"
        //        + "    deduction        decimal(10,2) not null,"
        //        + "    deducttime       int,"
        //        + "    is_signed        bit,"
        //        + "    represent_id     int not null,"
        //        + "    constraint xloans_pk primary key (xloans_id),"
        //        + "    constraint xloans_xemployee_fk foreign key (requestedby_id) references xemployee,"
        //        + "    constraint xloans_xemployee_fk2 foreign key (authorizedby_id) references xemployee,"
        //        + "    constraint xloans_xemployee_fk3 foreign key (represent_id) references xemployee"
        //        + ")",
        //        //                "drop table xemployeeincident",
        //        //                "drop table xmachineincident",
        //        //                "drop table xincidents",
        //        "create cached table xincidents"
        //        + "("
        //        + "    xincidents_id    int generated by default as identity (start with 1),"
        //        + "    reportdate       date not null,"
        //        + "    incidentdate     date not null,"
        //        + "    xsite_id         int,"
        //        + "    othermachines    varchar(512) not null,"
        //        + "    otherpeople      varchar(512),"
        //        + "    location         varchar(255),"
        //        + "    description      varchar(1024) not null,"
        //        + "    damages          varchar(1024) not null,"
        //        + "    estimated_cost   int not null,"
        //        + "    reportedby_id    int,"
        //        + "    reportedto_id    int,"
        //        + "    is_signed        bit,"
        //        + "    is_verified      bit,"
        //        + "    verifiedby_id    int,"
        //        + "    lost_income      int,"
        //        + "    constraint xincidents_pk primary key (xincidents_id),"
        //        + "    constraint xincidents_xsite_fk foreign key (xsite_id) references xsite,"
        //        + "    constraint xincidents_xemployee_fk foreign key (reportedby_id) references xemployee,"
        //        + "    constraint xincidents_xemployee_fk2 foreign key (reportedto_id) references xemployee,"
        //        + "    constraint xincidents_xemployee_fk3 foreign key (verifiedby_id) references xemployee"
        //        + ")",
        //        "create cached table xmachineincident"
        //        + "("
        //        + "    xmachineincident_id int generated by default as identity (start with 1),"
        //        + "    xincidents_id    int not null,"
        //        + "    xmachine_id      int not null,"
        //        + "    constraint xmachineincident_pk primary key (xmachineincident_id),"
        //        + "    constraint xmachineincident_xincidents_fk foreign key (xincidents_id) references xincidents on delete cascade,"
        //        + "    constraint xmachineincident_xmachine_fk foreign key (xmachine_id) references xmachine on delete cascade"
        //        + ")",
        //        "create cached table xemployeeincident"
        //        + "("
        //        + "    xemployeeincident_id int generated by default as identity (start with 1),"
        //        + "    xincidents_id        int not null,"
        //        + "    xemployee_id         int not null,"
        //        + "    constraint xemployeeincident_pk primary key (xemployeeincident_id),"
        //        + "    constraint xemployeeincident_xincidents_fk foreign key (xincidents_id) references xincidents on delete cascade,"
        //        + "    constraint xemployeeincident_xemployee_fk foreign key (xemployee_id) references xemployee on delete cascade"
        //        + ")",
        //        "create table xsalarylist"
        //        + "("
        //        + "    xsalarylist_id int generated by default as identity (start with 1),"
        //        + "    payday         date not null,"
        //        + "    constraint xsalarylist_pk primary key (xsalarylist_id)"
        //        + ")",
        //        "create table xsalary"
        //        + "("
        //        + "    xsalary_id     int generated by default as identity (start with 1),"
        //        + "    xsalarylist_id int not null,"
        //        + "    xemployee_id   int not null,"
        //        + "    amount         decimal(10,2) not null,"
        //        + "    constraint xsalary_pk primary key (xsalary_id),"
        //        + "    constraint xsalary_xsalarylist_fk foreign key (xsalarylist_id) references xsalarylist on delete cascade,"
        //        + "    constraint xsalary_xemployee_fk foreign key (xemployee_id) references xemployee"
        //        + ")",
        //        //version 19->20
        //        "create cached table xopclocksheet"
        //        + "("
        //        + "    xopclocksheet_id int generated by default as identity (start with 1),"
        //        + "    xemployee_id     int not null,"
        //        + "    xsite_id         int not null,"
        //        + "    sheet_date       date,"
        //        + "    xmachine_id      int not null,"
        //        + "    km_start1        int,"
        //        + "    km_stop1         int,"
        //        + "    work_from1       time,"
        //        + "    work_to1         time,"
        //        + "    stand_from1      time,"
        //        + "    stand_to1        time,"
        //        + "    reason1          varchar(255),"
        //        + "    km_start2        int,"
        //        + "    km_stop2         int,"
        //        + "    work_from2       time,"
        //        + "    work_to2         time,"
        //        + "    stand_from2      time,"
        //        + "    stand_to2        time,"
        //        + "    reason2          varchar(255),"
        //        + "    km_start3        int,"
        //        + "    km_stop3         int,"
        //        + "    work_from3       time,"
        //        + "    work_to3         time,"
        //        + "    stand_from3      time,"
        //        + "    stand_to3        time,"
        //        + "    reason3          varchar(255),"
        //        + "    km_start4        int,"
        //        + "    km_stop4         int,"
        //        + "    work_from4       time,"
        //        + "    work_to4         time,"
        //        + "    stand_from4      time,"
        //        + "    stand_to4        time,"
        //        + "    reason4          varchar(255),"
        //        + "    km_start5        int,"
        //        + "    km_stop5         int,"
        //        + "    work_from5       time,"
        //        + "    work_to5         time,"
        //        + "    stand_from5      time,"
        //        + "    stand_to5        time,"
        //        + "    reason5          varchar(255),"
        //        + "    km_start6        int,"
        //        + "    km_stop6         int,"
        //        + "    work_from6       time,"
        //        + "    work_to6         time,"
        //        + "    stand_from6      time,"
        //        + "    stand_to6        time,"
        //        + "    reason6          varchar(255),"
        //        + "    km_start7        int,"
        //        + "    km_stop7         int,"
        //        + "    work_from7       time,"
        //        + "    work_to7         time,"
        //        + "    stand_from7      time,"
        //        + "    stand_to7        time,"
        //        + "    reason7          varchar(255),"
        //        + "    constraint xopclocksheet_pk primary key (xopclocksheet_id),"
        //        + "    constraint xopclocksheet_xemployee_fk foreign key (xemployee_id) references xemployee,"
        //        + "    constraint xopclocksheet_xsite_fk foreign key (xsite_id) references xsite,"
        //        + "    constraint xopclocksheet_xmachine_fk foreign key (xmachine_id) references xmachine"
        //        + ")",
        //        "create cached table xjobcard"
        //        + "("
        //        + "    xjobcard_id      int generated by default as identity (start with 1),"
        //        + "    xemployee_id     int not null,"
        //        + "    carddate         date not null,"
        //        + "    week_ending      date not null,"
        //        + "    job1_day1        varchar(255),"
        //        + "    job2_day1        varchar(255),"
        //        + "    job3_day1        varchar(255),"
        //        + "    job4_day1        varchar(255),"
        //        + "    machine_id1_day1 int,"
        //        + "    machine_id2_day1 int,"
        //        + "    machine_id3_day1 int,"
        //        + "    machine_id4_day1 int,"
        //        + "    job1_day2        varchar(255),"
        //        + "    job2_day2        varchar(255),"
        //        + "    job3_day2        varchar(255),"
        //        + "    job4_day2        varchar(255),"
        //        + "    machine_id1_day2 int,"
        //        + "    machine_id2_day2 int,"
        //        + "    machine_id3_day2 int,"
        //        + "    machine_id4_day2 int,"
        //        + "    job1_day3        varchar(255),"
        //        + "    job2_day3        varchar(255),"
        //        + "    job3_day3        varchar(255),"
        //        + "    job4_day3        varchar(255),"
        //        + "    machine_id1_day3 int,"
        //        + "    machine_id2_day3 int,"
        //        + "    machine_id3_day3 int,"
        //        + "    machine_id4_day3 int,"
        //        + "    job1_day4        varchar(255),"
        //        + "    job2_day4        varchar(255),"
        //        + "    job3_day4        varchar(255),"
        //        + "    job4_day4        varchar(255),"
        //        + "    machine_id1_day4 int,"
        //        + "    machine_id2_day4 int,"
        //        + "    machine_id3_day4 int,"
        //        + "    machine_id4_day4 int,"
        //        + "    job1_day5        varchar(255),"
        //        + "    job2_day5        varchar(255),"
        //        + "    job3_day5        varchar(255),"
        //        + "    job4_day5        varchar(255),"
        //        + "    machine_id1_day5 int,"
        //        + "    machine_id2_day5 int,"
        //        + "    machine_id3_day5 int,"
        //        + "    machine_id4_day5 int,"
        //        + "    job1_day6        varchar(255),"
        //        + "    job2_day6        varchar(255),"
        //        + "    job3_day6        varchar(255),"
        //        + "    job4_day6        varchar(255),"
        //        + "    machine_id1_day6 int,"
        //        + "    machine_id2_day6 int,"
        //        + "    machine_id3_day6 int,"
        //        + "    machine_id4_day6 int,"
        //        + "    job1_day7        varchar(255),"
        //        + "    job2_day7        varchar(255),"
        //        + "    job3_day7        varchar(255),"
        //        + "    job4_day7        varchar(255),"
        //        + "    machine_id1_day7 int,"
        //        + "    machine_id2_day7 int,"
        //        + "    machine_id3_day7 int,"
        //        + "    machine_id4_day7 int,"
        //        + "    constraint xjobcard_pk primary key (xjobcard_id),"
        //        + "    constraint xjobcard_xemployee_fk foreign key (xemployee_id) references xemployee,"
        //        + "    constraint xjobcard_xmachine_fk11 foreign key (machine_id1_day1) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk21 foreign key (machine_id2_day1) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk31 foreign key (machine_id3_day1) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk41 foreign key (machine_id4_day1) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk12 foreign key (machine_id1_day2) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk22 foreign key (machine_id2_day2) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk32 foreign key (machine_id3_day2) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk42 foreign key (machine_id4_day2) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk13 foreign key (machine_id1_day3) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk23 foreign key (machine_id2_day3) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk33 foreign key (machine_id3_day3) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk43 foreign key (machine_id4_day3) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk14 foreign key (machine_id1_day4) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk24 foreign key (machine_id2_day4) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk34 foreign key (machine_id3_day4) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk44 foreign key (machine_id4_day4) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk15 foreign key (machine_id1_day5) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk25 foreign key (machine_id2_day5) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk35 foreign key (machine_id3_day5) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk45 foreign key (machine_id4_day5) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk16 foreign key (machine_id1_day6) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk26 foreign key (machine_id2_day6) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk36 foreign key (machine_id3_day6) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk46 foreign key (machine_id4_day6) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk17 foreign key (machine_id1_day7) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk27 foreign key (machine_id2_day7) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk37 foreign key (machine_id3_day7) references xmachine,"
        //        + "    constraint xjobcard_xmachine_fk47 foreign key (machine_id4_day7) references xmachine"
        //        + ")",
        //        "delete from sheet where sheetname='Salary lists'",
        //        "alter table xemployee add wage_category int",
        //        "alter table xemployee add bank_details varchar(512)",
        //        "insert into cbitems values(7,'wage_category',1,'Xlend Salaries')",
        //        "insert into cbitems values(8,'wage_category',2,'Xlend Wages')",
        //        "insert into cbitems values(9,'wage_category',3,'T&F Wages')",
        //        "insert into cbitems values(10,'wage_category',4,'Casual Wages')",
        //        "create cached table xhourcompare"
        //        + "("
        //        + "    xhourcompare_id int generated by default as identity (start with 1),"
        //        + "    month_year      date,"
        //        + "    xsite_id        int not null,"
        //        + "    operator_id     int not null,"
        //        + "    xmachine_id     int not null,"
        //        + "    constraint xhourcompare_pk primary key (xhourcompare_id),"
        //        + "    constraint xhourcompare_xsite_fk foreign key (xsite_id) references xsite,"
        //        + "    constraint xhourcompare_xemployee_fk foreign key (operator_id) references xemployee,"
        //        + "    constraint xhourcompare_xmachine_fk foreign key (xmachine_id) references xmachine"
        //        + ")",
        //        "create cached table xhourcompareday"
        //        + "("
        //        + "    xhourcompareday_id int generated by default as identity (start with 1),"
        //        + "    xhourcompare_id    int not null,"
        //        + "    day_no             int not null,"
        //        + "    ocs                double,"
        //        + "    hm                 double,"
        //        + "    dr                 double,"
        //        + "    std                double,"
        //        + "    tsh                double,"
        //        + "    tsn                double,"
        //        + "    invn               double,"
        //        + "    constraint xhourcompareday_pk primary key (xhourcompareday_id),"
        //        + "    constraint xhourcompareday_xhourcompare_fk foreign key (xhourcompare_id) references xhourcompare"
        //        + ")",
        //        //version 20->21
        //        "alter table xemployee alter column rate double",
        //        "alter table xemployee alter column bank_details rename to bank_name",
        //        "alter table xemployee add bank_account    varchar(32)",
        //        "alter table xemployee add branch_code_name varchar(32)",
        //        "alter table xemployee add bank_name2    varchar(128)",
        //        "alter table xemployee add bank_account2    varchar(32)",
        //        "alter table xemployee add branch_code_name2 varchar(32)",
        //        "alter table xemployee add bank_name3    varchar(128)",
        //        "alter table xemployee add bank_account3    varchar(32)",
        //        "alter table xemployee add branch_code_name3 varchar(32)",
        //        "alter table xemployee add photo3 other",
        //        "update xemployee set wage_category=2 where wage_category is null",
        //        "alter table xloans drop constraint XLOANS_XEMPLOYEE_FK3",
        //        "alter table xloans drop represent_id",
        //        "alter table xjobcard add job5_day1 varchar(255)",
        //        "alter table xjobcard add job5_day2 varchar(255)",
        //        "alter table xjobcard add job5_day3 varchar(255)",
        //        "alter table xjobcard add job5_day4 varchar(255)",
        //        "alter table xjobcard add job5_day5 varchar(255)",
        //        "alter table xjobcard add job5_day6 varchar(255)",
        //        "alter table xjobcard add job5_day7 varchar(255)",
        //        //        machine_id5_day1 int
        //        "alter table xjobcard add machine_id5_day1 int",
        //        "alter table xjobcard add machine_id5_day2 int",
        //        "alter table xjobcard add machine_id5_day3 int",
        //        "alter table xjobcard add machine_id5_day4 int",
        //        "alter table xjobcard add machine_id5_day5 int",
        //        "alter table xjobcard add machine_id5_day6 int",
        //        "alter table xjobcard add machine_id5_day7 int",
        //        "alter table xjobcard add constraint xjobcard_xmachine_fk51 foreign key (machine_id5_day1) references xmachine",
        //        "alter table xjobcard add constraint xjobcard_xmachine_fk52 foreign key (machine_id5_day2) references xmachine",
        //        "alter table xjobcard add constraint xjobcard_xmachine_fk53 foreign key (machine_id5_day3) references xmachine",
        //        "alter table xjobcard add constraint xjobcard_xmachine_fk54 foreign key (machine_id5_day4) references xmachine",
        //        "alter table xjobcard add constraint xjobcard_xmachine_fk55 foreign key (machine_id5_day5) references xmachine",
        //        "alter table xjobcard add constraint xjobcard_xmachine_fk56 foreign key (machine_id5_day6) references xmachine",
        //        "alter table xjobcard add constraint xjobcard_xmachine_fk57 foreign key (machine_id5_day7) references xmachine",
        //        "alter table xbreakdown drop constraint xbreakdown_xconsume_fk",
        //        "alter table xloans drop xconsume_id",
        //        "create cached table xbreakconsume"
        //        + "("
        //        + "    xbreakconsume_id  int generated by default as identity (start with 1),"
        //        + "    xconsume_id       int not null,"
        //        + "    xbreakdown_id     int not null,"
        //        + "    constraint xbreakconsume_pk primary key (xbreakconsume_id),"
        //        + "    constraint xbreakconsume_xconsume_fk foreign key (xconsume_id) references xconsume,"
        //        + "    constraint xbreakconsume_xbreakdown_fk foreign key (xbreakdown_id) references xbreakdown"
        //        + ")",
        //        "delete from sheet where parent_id in (select sheet_id from sheet where sheetname='REPORTS')",
        //        "delete from sheet where sheetname='REPORTS'",
        //        "insert into sheet(sheetname) values('REPORTS')",
        //        "insert into sheet(sheetname,parent_id) select 'Creditor Age Analysis',sheet_id from sheet where sheetname='REPORTS'",
        //        "insert into sheet(sheetname,parent_id) select 'Employee Summary',sheet_id from sheet where sheetname='REPORTS'",
        "create cached table reportgroup"
        + "("
        + "    reportgroup_id int generated by default as identity (start with 1),"
        + "    sheetgroup_id  int not null,"
        + "    sheet_id       int not null,"
        + "    constraint reportgroup_pk primary key (reportgroup_id),"
        + "    constraint reportgroup_sheet_fk foreign key (sheetgroup_id) references sheet on delete cascade,"
        + "    constraint reportgroup_sheet_fk2 foreign key (sheet_id) references sheet on delete cascade"
        + ")",
        "create unique index reportgrp_idx on reportgroup(sheetgroup_id,sheet_id)",
        "update sheet set sheetname='Creditor Age Analysis' where sheetname in('Supplier And Creditor','Creditor Age Analysys')",
        "update sheet set sheetname='Employee Summary' where sheetname='Employee'",
        //        "delete from sheet where sheetname='Creditor Age Analysis' and sheet_id>(select min(sheet_id) from sheet where sheetname='Creditor Age Analysis')",
        //        "delete from sheet where sheetname='Employee Summary' and sheet_id>(select min(sheet_id) from sheet where sheetname='Employee Summary')",
        //        "delete from sheet where sheetname='REPORTS' and sheet_id>(select min(sheet_id) from sheet where sheetname='REPORTS')",
        "insert into reportgroup (sheetgroup_id,sheet_id) values("
        + "select min(sheet_id) from sheet where sheetname='DOCS',"
        + "select min(sheet_id) from sheet "
        + " where sheetname='Creditor Age Analysis' "
        + "   and parent_id=(select min(sheet_id) from sheet where sheetname='REPORTS')"
        + ")",
        "insert into reportgroup (sheetgroup_id,sheet_id) values("
        + "select min(sheet_id) from sheet where sheetname='HR',"
        + "select min(sheet_id) from sheet "
        + " where sheetname='Employee Summary' "
        + "   and parent_id=(select min(sheet_id) from sheet where sheetname='REPORTS')"
        + ")",
        //        "delete from xmachtype where parenttype_id in "
        //            + "(select xmachtype_id from xmachtype where machtype='FrontEnd Loader' "
        //            + "   and xmachtype_id>(select min(xmachtype_id) from xmachtype where machtype='FrontEnd Loader'))",
        //        "delete from xmachtype where machtype='FrontEnd Loader' "
        //            + "and xmachtype_id>(select min(xmachtype_id) from xmachtype where machtype='FrontEnd Loader')",
        //        "delete from xmachtype where (not parenttype_id is null) and xmachtype_id not in "
        //            + "(select min(xmachtype_id) from xmachtype group by machtype,parenttype_id,classify having count(*)>1)",
        "drop index cbitems_uniq_idx",
        "create unique index cbitems_uniq_idx on cbitems (name, id)",
        "alter table userprofile add supervisor smallint",
        "create unique index xmachtype_parenttype_idx on xmachtype(machtype,parenttype_id)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(24,'D31', 1)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(25,'D41', 1)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(26,'D4H', 1)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(27,'D65', 1)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(28,'D6H', 1)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(29,'D6R', 1)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(30,'428B 4X4',2)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(31,'428B 4X2',2)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(32,'428C 4X4',2)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(33,'428C 4X2',2)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(34,'428E 4X4',2)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(35,'428E HAMMER',2)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(36,'428E 4X2',2)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(37,'422E 4X4',2)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(38,'422E 4X2',2)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(39,'434E 4X4',2)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(40,'434E HAMMER',2)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(41,'PADFOOT ROLLER',3)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(42,'SMOOTH DRUM ROLLER',3)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(43,'2.5TON ROLLER',3)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(44,'PNEUMATIC ROLLER',3)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(45,'320 CAT',4)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(46,'322 CAT',4)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(47,'322 CAT HAMMER',4)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(48,'325 CAT',4)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(49,'330 CAT',4)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(50,'PC200',4)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(51,'PC300',4)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(52,'216B',5)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(53,'EXCAVATING ATTACHMENT',5)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(54,'BROOM ATTACHMENT',5)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(55,'HAMMER ATTACHMENT',5)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(56,'140H',6)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(57,'140G',6)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(58,'TRACTOR WITH SLASHER',7)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(59,'TELESCOPIC HANDLER',7)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(60,'BELL 225A LOGGER',7)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(61,'MERCEDES 1414',8)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(62,'TOYOTA 6000',8)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(63,'TATA LPT',8)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(64,'MERCEDES ATEGO',8)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(65,'OTHER',8)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(66,'TATA NOVUS 3434',9)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(67,'MITCHUBISHI FUSO',9)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(68,'MERCEDES ACTROS',9)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(69,'SAMAG',9)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(70,'BLUNT NOSE MERCEDES',9)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(71,'NISSAN CW46',9)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(72,'OTHER',9)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(73,'6000L',6)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(74,'12000L',6)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(75,'HILUX',16)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(76,'HILUX HIGH RIDER',16)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(77,'NISSAN 1400',16)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(78,'OTHER',16)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(79,'TOYOTA DYNA',17)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(80,'MERCEDES VITO',18)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(81,'MERCEDES SPRINTER',18)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(82,'9 SEATER SPRINTER',19)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(83,'12 SEATER SPRINTER',19)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(84,'VOLKSWAGEN MICROBUS',20)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(85,'KIA PREGIO',20)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(86,'DEFENDER 100',21)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(87,'DEFENDER 110',21)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(88,'DISCOVERY 2',21)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(89,'BMW 318',22)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(90,'BMW 328',22)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(91,'MERCEDES C220',22)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(92,'MERCEDES C280',22)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(93,'AUDI',22)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(94,'HONDA',23)",
        "insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(95,'BMW',23)",
        "insert into xmachtype(machtype,parenttype_id) select 'Kamatsu FEL',xmachtype_id from xmachtype where machtype='FrontEnd Loader'",
        "insert into xmachtype(machtype,parenttype_id) select 'Case TLB',xmachtype_id from xmachtype where machtype='TLB'",
        "insert into cbitems values(11,'rated_machines',1,'6m Tipper')",
        "insert into cbitems values(12,'rated_machines',2,'10m Tipper')",
        "insert into cbitems values(11,'rated_machines',1,'6m Tipper')",
        "insert into cbitems values(12,'rated_machines',2,'10m Tipper')",
        "insert into cbitems values(13,'rated_machines',3,'Dumper Truck')",
        "insert into cbitems values(14,'rated_machines',4,'10 000L Watercart')",
        "insert into cbitems values(15,'rated_machines',5,'14 000L Watercart')",
        "insert into cbitems values(16,'rated_machines',6,'Lowbed 3 axle')",
        "insert into cbitems values(17,'rated_machines',7,'Lowbed 2 axle')",
        "insert into cbitems values(18,'rated_machines',8,'Lowbed 1 axle')",
        "insert into cbitems values(19,'rated_machines',9,'Bobcat')",
        "insert into cbitems values(20,'rated_machines',10,'Bobcat With Broom Attachment')",
        "insert into cbitems values(21,'rated_machines',11,'Bobcat With Excavator Attachment')",
        "insert into cbitems values(22,'rated_machines',12,'Small Roller')",
        "insert into cbitems values(23,'rated_machines',13,'Smooth Drum Roller')",
        "insert into cbitems values(24,'rated_machines',14,'Padfoot Roller')",
        "insert into cbitems values(25,'rated_machines',15,'D4 Dozer')",
        "insert into cbitems values(26,'rated_machines',17,'D65 Dozer')",
        "insert into cbitems values(27,'rated_machines',18,'TLB')",
        "insert into cbitems values(28,'rated_machines',19,'TLB with Pecker')",
        "insert into cbitems values(29,'rated_machines',20,'Front End Loader')",
        "insert into cbitems values(30,'rated_machines',21,'Excavator 20T')",
        "insert into cbitems values(31,'rated_machines',22,'Excavator 30T')",
        "insert into cbitems values(32,'rated_machines',23,'Grader')",
        //version 20->21
        "create cached table xmachrentalrate"
        + "("
        + "    xmachrentalrate_id int generated by default as identity (start with 1),"
        + "    actual_date        date,"
        + "    diesel_price       decimal(6,2),"
        + "    factor             decimal(6,2),"
        + "    constraint xmachinerentalrate_pk primary key (xmachrentalrate_id)"
        + ")",
        //        "drop table xmachrentalrateitm",
        "create cached table xmachrentalrateitm"
        + "("
        + "    xmachrentalrateitm_id  int generated by default as identity (start with 1),"
        + "    cbitem_id              int not null,"
        + "    xmachrentalrate_id     int not null,"
        + "    litres_hour            decimal(8,2) not null,"
        + "    dry                    decimal(8,2) not null,"
        + "    real_wet               decimal(8,2) not null,"
        + "    good_wet               decimal(8,2) not null,"
        + "    constraint xmachrentalrateitm_pk primary key (xmachrentalrateitm_id),"
        + "    constraint xmachrentalrateitm_xmachrentalrate_fk foreign key (xmachrentalrate_id) references xmachrentalrate on delete cascade,"
        + "    constraint xmachrentalrateitm_cbitem_fk foreign key (cbitem_id) references cbitems"
        + ")",
        "create cached table xtransscheduleitm"
        + "("
        + "    xtransscheduleitm_id   int generated by default as identity (start with 1),"
        + "    machine_id             int not null,"
        + "    site_from_id           int not null,"
        + "    site_to_id             int not null,"
        + "    date_required          date,"
        + "    date_move              date,"
        + "    lowbed_id              int,"
        + "    operator_id            int,"
        + "    is_completed           bit,"
        + "    constraint xtransscheduleitm_pk primary key (xtransscheduleitm_id),"
        + "    constraint xtransscheduleitm_xmachine_fk foreign key (machine_id) references xmachine,"
        + "    constraint xtransscheduleitm_xsite_fk foreign key (site_from_id) references xsite,"
        + "    constraint xtransscheduleitm_xsite_fk2 foreign key (site_to_id) references xsite,"
        + "    constraint xtransscheduleitm_xmachine_fk2 foreign key (lowbed_id) references xlowbed,"
        + "    constraint xtransscheduleitm_xemployee_fk foreign key (operator_id) references xemployee"
        + ")",
        //version 25
        "alter table xsite add xorder2_id int",
        "alter table xsite add xorder3_id int",
        "alter table xsite add constraint xsite_xorder_fk2 foreign key (xorder2_id) references xorder",
        "alter table xsite add constraint xsite_xorder_fk3 foreign key (xorder3_id) references xorder",
        "alter table xemployee add employment_start date",
        "alter table xconsume add xsite_id int",
        "alter table xconsume add constraint xconsume_xsite_fk foreign key (xsite_id) references xsite",
        "insert into cbitems values(33,'site_types',1,'Work Site')",
        "insert into cbitems values(34,'site_types',2,'Additional')",
        "insert into cbitems values(35,'site_types',3,'DEPOT')",
        "alter table xabsenteeism drop constraint xabsenteeism_xmachine_fk",
        "alter table xabsenteeism alter xmachine_id int null",
        "alter table xabsenteeism add constraint xabsenteeism_xmachine_fk foreign key (xmachine_id) references xmachine",
//        "drop table xopmachassing",
        "create cached table xopmachassing"
        + "("
        + "    xopmachassing_id int generated by default as identity (start with 1),"
        + "    xsite_id         int not null,"
        + "    xemployee_id     int,"
        + "    xmachine_id      int,"
        + "    date_start       date not null,"
        + "    date_end         date,"
        + "    constraint xopmachassing_pk primary key (xopmachassing_id),"
        + "    constraint xopmachassing_xsite_fk foreign key (xsite_id) references xsite,"
        + "    constraint xopmachassing_xemployee_fk foreign key (xemployee_id) references xemployee on delete cascade,"
        + "    constraint xopmachassing_xmachine_fk foreign key (xmachine_id) references xmachine"
        + ")",
        "create unique index xopmachassing_uniq_idx on xopmachassing (date_start, xsite_id, xemployee_id, xmachine_id)"
    };

    public static Connection getConnection() throws RemoteException {
        Connection connection = null;
        try {
            Locale.setDefault(Locale.ENGLISH);
            DriverManager.registerDriver(
                    (java.sql.Driver) Class.forName(
                    props.getProperty("dbDriverName",
                    "org.hsqldb.jdbcDriver")).newInstance());
            connection = DriverManager.getConnection(
                    props.getProperty("dbConnection",
                    "jdbc:hsqldb:file://" + getCurDir() + "/DB/XlendServer"),
                    props.getProperty("dbUser", "sa"),
                    props.getProperty("dbPassword", ""));
            connection.setAutoCommit(true);
        } catch (Exception e) {
            XlendServer.log(e);
        }
        if (isFirstTime && props.getProperty("dbDriverName", "org.hsqldb.jdbcDriver").equals("org.hsqldb.jdbcDriver")) {
            initLocalDB(connection);
            fixLocalDB(connection);
            isFirstTime = false;
        }
        return checkVersion(connection);
    }

    public static void initLocalDB(Connection connection) {
        sqlBatch(createLocalDBsqls, connection, false);
    }

    public static void fixLocalDB(Connection connection) {
        sqlBatch(fixLocalDBsqls, connection, props.getProperty("LogDbFixes", "false").equalsIgnoreCase("true"));
    }

    private static void sqlBatch(String[] sqls, Connection connection, boolean tolog) {
        PreparedStatement ps = null;
        for (int i = 0; i < sqls.length; i++) {
            try {
//                System.out.println(""+i+") "+sqls[i]);
                ps = connection.prepareStatement(sqls[i]);
                ps.execute();
                if (tolog) {
                    XlendServer.log("STATEMENT [" + sqls[i].substring(0,
                            sqls[i].length() > 60 ? 60 : sqls[i].length()) + "]... processed");
                }
            } catch (SQLException e) {
                if (tolog) {
                    XlendServer.log(e);
                }
            } finally {
                try {
                    ps.close();
                } catch (SQLException ex) {
                }
            }
        }
    }

//    public static void recreateSiteDiary() {
//        String[] sqlArr = new String[]{
//            "drop table xsitediarypart",
//            "drop table xsitediary",
//            "create cached table xsitediary"
//            + "("
//            + "    xsitediary_id    int generated by default as identity (start with 1),"
//            + "    diarydate        date not null,"
//            + "    xsite_id         int not null,"
//            + "    manager_id       int not null,"
//            + "    site_foreman     varchar(32),"
//            + "    site_number      varchar(32),"
//            + "    constraint xsitediary_pk primary key (xsitediary_id),"
//            + "    constraint xsitediary_xsite_fk foreign key (xsite_id) references xsite,"
//            + "    constraint xsitediary_xemployee_fk foreign key (manager_id) references xemployee"
//            + ")",
//            "create cached table xsitediarypart"
//            + "("
//            + "    xsitediarypart_id  int generated by default as identity (start with 1),"
//            + "    xsitediary_id      int not null,"
//            + "    partdate           date not null,"
//            + "    xmachine_id        int not null,"
//            + "    hrs_worked         int not null,"
//            + "    hrs_standing       int not null,"
//            + "    operator_id        int not null,"
//            + "    comments           varchar(1024),"
//            + "    constraint xsitediarypart_pk primary key (xsitediarypart_id),"
//            + "    constraint xsitediarypart_xsitediary_fk foreign key (xsitediary_id) references xsitediary on delete cascade,"
//            + "    constraint xsitediarypart_xmachine_fk foreign key (xmachine_id) references xmachine,"
//            + "    constraint xsitediarypart_xemployee_fk foreign key (operator_id) references xemployee"
//            + ")"
//        };
//        Connection conn = null;
//        try {
//            conn = getConnection();
//            if (conn != null) {
//                sqlBatch(sqlArr, conn, true);
//            }
//        } catch (RemoteException ex) {
//            XlendServer.log(ex);
//        } finally {
//            try {
//                closeConnection(conn);
//            } catch (Exception ex) {
//            }
//        }
//    }
    public static void setProps(Properties props) {
        DbConnection.props = props;
    }

    public static void closeConnection(Connection connection) throws SQLException {
//        connection.commit();
        connection.close();
        connection = null;
    }

    private static String getCurDir() {
        File curdir = new File("./");
        return curdir.getAbsolutePath();
    }

    private static Connection checkVersion(Connection connection) throws RemoteException {
        PreparedStatement ps = null;
        ResultSet rs = null;
        String err;
        String stmt = "SELECT version_id,version FROM dbversion WHERE dbversion_id=1";
        int curversion_id = 0;
        String curversion = "0.0";
        try {
            ps = connection.prepareStatement(stmt);
            rs = ps.executeQuery();
            if (rs.next()) {
                curversion_id = rs.getInt(1);
                curversion = rs.getString(2);
            }
            if (DB_VERSION_ID > curversion_id || !curversion.equals(DB_VERSION)) {
                err = "Invalid database version! " + "expected:" + DB_VERSION + "(" + DB_VERSION_ID + ") "
                        + "found:" + curversion + "(" + curversion_id + ")";
                XlendServer.log(err);
                throw new RemoteException(err);
            }
        } catch (SQLException ex) {
            XlendServer.log(ex);
            try {
                closeConnection(connection);
            } catch (SQLException ex1) {
            }
        } finally {
            try {
                if (rs != null) {
                    try {
                        rs.close();
                    } catch (SQLException ex) {
                    }
                }
            } finally {
                if (ps != null) {
                    try {
                        ps.close();
                    } catch (SQLException ex) {
                    }
                }
            }
        }
        return connection;
    }

//    public static void shutDownDatabase() {
//        Connection connection = null;
//        try {
//            connection = getConnection();
//            sqlBatch(new String[]{"sutdown"}, connection, true);
//        } catch (RemoteException ex) {
//            XlendServer.log(ex);
//        } finally {
//            try {
//                closeConnection(connection);
//            } catch (SQLException ex1) {
//            }
//        }
//    }
    private static String[] loadDDLscript(String fname) {
        String[] ans = new String[0];
        File sqlFile = new File(fname);
        boolean toclean = true;
        if (!sqlFile.exists()) {
            fname = "../sql/" + fname;
            sqlFile = new File(fname);
            toclean = false;
        }
        if (sqlFile.exists()) {
            StringBuffer contents = new StringBuffer();
            java.io.BufferedReader reader = null;
            try {
                reader = new java.io.BufferedReader(new FileReader(sqlFile));
                String line = null;
                int lineNum = 0;
                while ((line = reader.readLine()) != null) {
                    int cut = line.indexOf("--");
                    if (cut >= 0) {
                        line = line.substring(0, cut);
                    }
                    contents.append(line).append(System.getProperty("line.separator"));
                }
                ans = contents.toString().split(";");
            } catch (Exception e) {
                XlendServer.log(e);
            } finally {
                try {
                    if (reader != null) {
                        reader.close();
                    }
                } catch (IOException ie) {
                }
            }
            if (toclean) {
                sqlFile.delete();
            }
        } else {
            XlendServer.log("File " + fname + " not found");
        }
        return ans;
    }
}
