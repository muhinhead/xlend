
create cached table dbversion
(
    dbversion_id    int generated by default as identity (start with 1),
    version_id      int not null,
    version         varchar(12),
    constraint dbversion_pk primary key (dbversion_id)
);

insert into dbversion values(1,28,'0.28');


create cached table picture
(
    picture_id   int generated by default as identity (start with 1),
    picture      other,
    constraint picture_pk primary key (picture_id)
);

create cached table profile 
(
    profile_id   int generated by default as identity (start with 1),
    first_name   varchar(32) not null,
    last_name    varchar(32) not null,
    address1     varchar(80) not null,
    address2     varchar(80),
    city         varchar(48),
    state        varchar(12),
    zip_code     varchar(12),
    phone        varchar(12),
    cell_phone   varchar(12),
    email        varchar(80),
    picture_id   int,
    constraint profile_pk primary key (profile_id),
    constraint profile_picture_fk foreign key (picture_id) references picture
);

create cached table userprofile
(
    profile_id   int not null,
    fax          varchar(12),
    webaddress   varchar(80),
    office_hours varchar(48),
    salesperson  smallint,
    manager      smallint,
    supervisor   smallint,
    login        varchar(16),
    pwdmd5       varchar(32),
    constraint userprofile_pk primary key (profile_id),
    constraint userprofile_profile_fk foreign key (profile_id) references profile on delete cascade
);

create cached table sheet
(
    sheet_id  int generated by default as identity (start with 1),
    sheetname varchar(32) not null,
    classname varchar(64),
    parent_id int,
    constraint sheet_pk primary key (sheet_id)
);--

--insert into sheet (sheetname,classname) values('DOCS','com.xlend.gui.work.DocFrame');
--insert into sheet (sheetname,classname) values('SITES','com.xlend.gui.work.SitesFrame');
--insert into sheet (sheetname,classname) values('REPORTS',null);
--insert into sheet (sheetname,classname) values('HR','com.xlend.gui.HRFrame');
--insert into sheet (sheetname,classname) values('FLEET','package com.xlend.gui.FleetFrame');


create cached table usersheet
(
    usersheet_id int generated by default as identity (start with 1),
    profile_id   int not null,
    sheet_id     int not null,
    constraint usersheet_pk primary key (usersheet_id),
    constraint usersheet_sheet_fk foreign key (sheet_id) references sheet on delete cascade,
    constraint usersheet_user_fk foreign key (profile_id) references userprofile on delete cascade
);

create cached table reportgroup
(
    reportgroup_id int generated by default as identity (start with 1),
    sheetgroup_id  int not null,
    sheet_id       int not null,
    constraint reportgroup_pk primary key (reportgroup_id),
    constraint reportgroup_sheet_fk foreign key (sheetgroup_id) references sheet on delete cascade,
    constraint reportgroup_sheet_fk2 foreign key (sheet_id) references sheet on delete cascade
);

create cached table clientprofile
(
    profile_id        int not null,
    salesperson_id    int,
    birthday          date,
    source_type       varchar(10), --check (source_type in('Phonebook','Referral','Location','Others')),
    source_descr      varchar(255),
    sales_potential   int,
    constraint clientprofile_pk primary key (profile_id),
    constraint clientprofile_profile_spers_fk foreign key (salesperson_id) references profile,
    constraint clientprofile_profile_fk foreign key (profile_id) references profile on delete cascade
);

create cached table xclient
(
    xclient_id      int generated by default as identity (start with 1),
    clientcode      varchar(16) not null,
    companyname     varchar(255) not null,
    contactname     varchar(255),
    phonenumber     varchar(12),
    vatnumber       varchar(32),
    address         varchar(255),
    description     varchar(255),
    constraint xclient_pk primary key (xclient_id)
);

create cached table xcontract
(
    xcontract_id   int generated by default as identity (start with 1),
    contractref    varchar(32) not null,
    description    varchar(255),
    xclient_id     int not null,
    constraint xcontract_pk primary key (xcontract_id),
    constraint xcontract_xclient_fk foreign key (xclient_id) references xclient
);

create cached table xcontractpage --implements IPage
(
    xcontractpage_id   int generated by default as identity (start with 1),
    xcontract_id       int not null,
    pagenum            int,
    description        varchar(64),
    fileextension      varchar(8),
    pagescan           other, 
    constraint xcontractpage_pk primary key (xcontractpage_id),
    constraint xcontractpage_xcontract_fk foreign key (xcontract_id) references xcontract on delete cascade
);
 
create cached table xquotation
(
    xquotation_id      int generated by default as identity (start with 1),
    xclient_id         int not null,
    rfcnumber          varchar(32) not null,
    received           date,
    deadline           date,
    responded          date,
    responsedby        varchar(12),
    responsecmnt       varchar(128),
    responder_id       int,
    responsedoc        other,
    constraint xquotation_pk primary key (xquotation_id),
    constraint xquotation_xclient_fk foreign key (xclient_id) references xclient,
    constraint xquotation_profile_fk foreign key (responder_id) references userprofile
);   
 
create cached table xquotationpage --implements IPage
(
    xquotationpage_id  int generated by default as identity (start with 1),
    xquotation_id      int not null,
    pagenum            int,
    description        varchar(64),
    fileextension      varchar(8),
    pagescan           other, 
    constraint xquotationpage_pk primary key (xquotationpage_id),
    constraint xquotationpage_xquotation_fk foreign key (xquotation_id) references xquotation on delete cascade
);

create cached table xorder
(
    xorder_id          int generated by default as identity (start with 1),
    xclient_id         int not null,
    xcontract_id       int,
    xquotation_id      int,
    ordernumber        varchar(32) not null,
    orderdate          date not null,
    contactname        varchar(255),
    contactphone       varchar(32),
    contactfax         varchar(32),
    deliveryaddress    varchar(255) not null,
    invoiceaddress     varchar(255) not null,
    constraint xorder_pk primary key (xorder_id),
    constraint xorder_xclient_fk foreign key (xclient_id) references xclient,
    constraint xorder_xquotation_fk  foreign key (xquotation_id) references xquotation,
    constraint xorder_xcontract foreign key (xcontract_id) references xcontract
);                            

create cached table xsite
(
    xsite_id        int generated by default as identity (start with 1),                
    name            varchar(32) not null,
    description     varchar(255),
    dieselsponsor   smallint default 0,
    sitetype        char(1),
    xorder_id       int,
    xorder2_id      int,
    xorder3_id      int,
    is_active       bit,
    constraint xsite_id primary key (xsite_id),
    constraint xsite_xorder_fk foreign key (xorder_id) references xorder,
    constraint xsite_xorder_fk2 foreign key (xorder2_id) references xorder,
    constraint xsite_xorder_fk3 foreign key (xorder3_id) references xorder
);

create cached table xorderpage --implements IPage
(
    xorderpage_id     int generated by default as identity (start with 1),
    xorder_id         int not null,
    pagenum           int,
    description       varchar(64),
    fileextension      varchar(8),
    pagescan          other,
    constraint xorderpage_pk primary key (xorderpage_id),
    constraint xorderpage_xorder_fk foreign key (xorder_id) references xorder on delete cascade 
);

create cached table xposition
(
    xposition_id    int generated by default as identity (start with 1),
    pos             varchar(64) not null,
    constraint xposition_pk primary key (xposition_id)
);

--create cached table employeeshort -- not real table, just for Web page HR.jsp
--(
--    xemployee_id    int generated by default as identity (start with 1),
--    clock_num       varchar(8)  not null,
--    first_name      varchar(16) not null,
--    sur_name        varchar(16) not null,
--    nick_name       varchar(16) not null,
--    xposition_id    int,
--    constraint xemployee_pk primary key (xemployee_id)
--);

create cached table xemployee
(
    xemployee_id    int generated by default as identity (start with 1),
    clock_num       varchar(8)  not null,
    first_name      varchar(16) not null,
    sur_name        varchar(16) not null,
    nick_name       varchar(16) not null,
    id_num          varchar(16) not null,
    phone0_num      varchar(16) not null,
    phone1_num      varchar(16),
    phone2_num      varchar(16),
    relation1       varchar(16), 
    relation2       varchar(16), 
    address         varchar(128) not null, 
    contract_len    int          not null, --1/3/6/12/0
    contract_start  date         not null,
    contract_end    date,
    rate            double not null,
    xposition_id    int,
    taxnum          varchar(32),
    photo           other,
    photo2          other,newSelect
    photo3          other,
    deceased        bit,
    dismissed       bit,
    absconded       bit,
    resigned        bit,
    deceased_date   date,
    dismissed_date  date,
    absconded_date  date,
    resigned_date   date,
    wage_category   int,
    bank_name       varchar(128),
    bank_account    varchar(32),
    branch_code_name varchar(32),
    bank_name2       varchar(128),
    bank_account2    varchar(32),
    branch_code_name2 varchar(32),
    bank_name3        varchar(128),
    bank_account3     varchar(32),
    branch_code_name3 varchar(32),
    employment_start date,
    management      bit default 0,
    clock_numonly   smallint,
    constraint xemployee_pk primary key (xemployee_id),
    constraint xemployee_xposition_fk foreign key (xposition_id) references xposition
);

create cached table xmachtype
(
    xmachtype_id     int generated by default as identity (start with 1),
    machtype         varchar(32) not null,
    parenttype_id    int,
    classify         char(1),
    is_rated         bit,
    constraint xmachtype_pk primary key (xmachtype_id)
    --,constraint xmachtype_xmachtype_fk foreign key (parenttype_id) references xmachtype
);
create unique index xmachtype_parenttype_idx on xmachtype(machtype,parenttype_id);

--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(1,'Buldozer',null,'M');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(2,'TLB',null,'M');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(3,'Roller',null,'M');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(4,'Excavator',null,'M');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(5,'Bobcat',null,'M');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(6,'Grader',null,'M');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(7,'Other',null,'M');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(8,'6M TIPPER',null,'T');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(9,'10M TIPPER',null,'T');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(10,'WATERCARTS',null,'T');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(11,'TATA NOVUS 5542',null,'L');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(12,'FORD LOUISVILLE',null,'L');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(13,'INTERNATIONAL S-LINE',null,'L');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(14,'SINGLE AXLE MERCEDES',null,'L');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(15,'VOLVO F12',null,'L');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(16,'PICK-UP',null(machtype,,'P');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(17,'BREAK-DOWN',null,'P');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(18,'PANELVAN',null,'P');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(19,'BUS',null,'P');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(20,'MINI BUS',null,'P');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(21,'LAND ROVER',null,'V');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(22,'SEDAN',null,'V');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id,classify) values(23,'BIKE',null,'V');
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(24,'D31', 1);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(25,'D41', 1);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(26,'D4H', 1);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(27,'D65', 1);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(28,'D6H', 1);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(29,'D6R', 1);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(30,'428B 4X4',2);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(31,'428B 4X2',2);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(32,'428C 4X4',2);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(33,'428C 4X2',2);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(34,'428E 4X4',2);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(35,'428E HAMMER',2);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(36,'428E 4X2',2);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(37,'422E 4X4',2);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(38,'422E 4X2',2);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(39,'434E 4X4',2);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(40,'434E HAMMER',2);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(41,'PADFOOT ROLLER',3);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(42,'SMOOTH DRUM ROLLER',3);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(43,'2.5TON ROLLER',3);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(44,'PNEUMATIC ROLLER',3);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(45,'320 CAT',4);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(46,'322 CAT',4);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(47,'322 CAT HAMMER',4);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(48,'325 CAT',4);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(49,'330 CAT',4);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(50,'PC200',4);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(51,'PC300',4);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(52,'216B',5);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(53,'EXCAVATING ATTACHMENT',5);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(54,'BROOM ATTACHMENT',5);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(55,'HAMMER ATTACHMENT',5);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(56,'140H',6);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(57,'140G',6);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(58,'TRACTOR WITH SLASHER',7);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(59,'TELESCOPIC HANDLER',7);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(60,'BELL 225A LOGGER',7);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(61,'MERCEDES 1414',8);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(62,'TOYOTA 6000',8);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(63,'TATA LPT',8);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(64,'MERCEDES ATEGO',8);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(65,'OTHER',8);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(66,'TATA NOVUS 3434',9);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(67,'MITCHUBISHI FUSO',9);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(68,'MERCEDES ACTROS',9);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(69,'SAMAG',9);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(70,'BLUNT NOSE MERCEDES',9);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(71,'NISSAN CW46',9);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(72,'OTHER',9);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(73,'6000L',6);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(74,'12000L',6);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(75,'HILUX',16);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(76,'HILUX HIGH RIDER',16);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(77,'NISSAN 1400',16);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(78,'OTHER',16);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(79,'TOYOTA DYNA',17);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(80,'MERCEDES VITO',18);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(81,'MERCEDES SPRINTER',18);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(82,'9 SEATER SPRINTER',19);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(83,'12 SEATER SPRINTER',19);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(84,'VOLKSWAGEN MICROBUS',20);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(85,'KIA PREGIO',20);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(86,'DEFENDER 100',21);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(87,'DEFENDER 110',21);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(88,'DISCOVERY 2',21);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(89,'BMW 318',22);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(90,'BMW 328',22);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(91,'MERCEDES C220',22);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(92,'MERCEDES C280',22);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(93,'AUDI',22);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(94,'HONDA',23);
--insert into xmachtype (xmachtype_id,machtype,parenttype_id) values(95,'BMW',23);
--
--insert into xmachtype(machtype,parenttype_id,classify) values('FrontEnd Loader',null,'M');
--insert into xmachtype(machtype,parenttype_id) select 'Kamatsu FEL',xmachtype_id from xmachtype where machtype='FrontEnd Loader';
--insert into xmachtype(machtype,parenttype_id) select 'Case TLB',xmachtype_id from xmachtype where machtype='TLB';
                        

create cached table xmachine
(
    xmachine_id     int generated by default as identity (start with 1),
    tmvnr           varchar(3) not null,
    xmachtype_id    int not null,
    xmachtype2_id   int,
    reg_nr          varchar(32),
    expdate         date,
    vehicleid_nr    varchar(32),
    engine_nr       varchar(32),
    chassis_nr      varchar(32),
    classify        char(1),
    insurance_nr    varchar(32),
    insurance_tp    varchar(32),
    insurance_amt   decimal(10,2),
    deposit_amt     decimal(10,2),
    contract_fee    int,
    monthly_pay     int,
    paystart        date,
    payend          date,
    photo           other,
    consumption     int,
    fueltype        int,
    constraint xmachine_pk primary key (xmachine_id),
--    constraint xmachine_xmachtype_fk foreign key (xmachtype_id) references xmachtype
);

create cached table xtimesheet
(
    xtimesheet_id int generated by default as identity (start with 1),
    xemployee_id  int not null,
    xorder_id     int null,
    xsite_id      int not null,
    weekend       date,
    clocksheet    smallint default 1,
    image         other,
    xmachine_id   int,
    constraint xtimesheet_pk primary key (xtimesheet_id),
    constraint xtimesheet_xemployee_fk foreign key (xemployee_id) references xemployee on delete cascade,
    constraint xtimesheet_xorder_fk foreign key (xorder_id) references xorder,
    constraint xtimesheet_xsite_fk foreign key (xsite_id) references xsite,
    constraint xtimesheet_xmachine_fk foreign key (xmachine_id) references xmachine (xmachine_id)
);

create unique index xtimesheet_uniq on xtimesheet (xemployee_id, weekend);

create cached table xwage
(
    xwage_id       int generated by default as identity (start with 1),
    xtimesheet_id  int not null,
    day            date,
    normaltime     double,
    overtime       double,
    doubletime     double,
    stoppeddetails varchar(128),
    tsnum          int, 
    constraint xwage_pk primary key (xwage_id),
    constraint xwage_xtimesheet_fk foreign key (xtimesheet_id) references xtimesheet on delete cascade
);

create cached table xwagesum
(
    xwagesum_id int generated by default as identity (start with 1),
    weekend     date,
    constraint xwagesum_pk primary key (xwagesum_id)
);

create cached table xwagesumitem
(
    xwagesumitem_id int generated by default as identity (start with 1),
    xwagesum_id     int,
    xemployee_id    int not null,
    xtimesheet_id   int,
    weeklywage      int,
    normaltime      double,
    overtime        double,
    doubletime      double,
    constraint xwagesumitem_pk primary key (xwagesumitem_id),
    constraint xwagesumitem_xwagesum_fk foreign key (xwagesum_id) references xwagesum on delete cascade,
    constraint xwagesumitem_xemployee_fk foreign key (xemployee_id) references xemployee on delete cascade,
    constraint xwagesumitem_xtimesheet_fk foreign key (xtimesheet_id) references xtimesheet
);

create cached table xlowbed
(
    xlowbed_id      int generated by default as identity (start with 1),
    xmachine_id     int not null,
    driver_id       int,
    assistant_id    int,
    constraint xlowbed_pk primary key (xlowbed_id),
    constraint xlowbed_xmachine_fk foreign key (xmachine_id) references xmachine,
    constraint xlowbed_xemployee_fk foreign key (driver_id) references xemployee,
    constraint xlowbed_xemployee_fk2 foreign key (assistant_id) references xemployee
);

create cached table xtrip
(
    xtrip_id      int generated by default as identity (start with 1),
    xlowbed_id    int not null,
    trip_date     date not null,
    fromsite_id   int not null,
    insite_id     int,
    tosite_id     int,
    othersite     varchar(128),
    driver_id     int,
    assistant_id  int,
    trip_type     int not null,
    distance_empty  int,
    distance_loaded int,
    machine_id      int,
    withmachine_id  int,
    is_copmplete    bit,
    operator_id     int,
    constraint xtrip_pk primary key (xtrip_id),
    constraint xtrip_xlowbed_fk foreign key (xlowbed_id) references xlowbed on delete cascade,
    constraint xtrip_xsite_fk foreign key (fromsite_id) references xsite,
    constraint xtrip_xsite_fk2 foreign key (tosite_id) references xsite,
    constraint xtrip_xsite_fk3 foreign key (insite_id) references xsite,
    constraint xtrip_xemployee_fk foreign key (driver_id) references xemployee,
    constraint xtrip_xemployee_fk2 foreign key (assistant_id) references xemployee,
    constraint xtrip_xemployee_fk3 foreign key (operator_id) references xemployee,
    constraint xtrip_xmachine_fk foreign key (machine_id) references xmachine,
    constraint xtrip_xmachine_fk2 foreign key (withmachine_id) references xmachine
);

create cached table xorderitem
(
    xorderitem_id     int generated by default as identity (start with 1),
    xorder_id         int not null,
    itemnumber        varchar(16) not null,
    deliveryreq       date,
    delivery          date,
    quantity          int not null,
    measureitem       varchar(16),
    priceperone       decimal(10,2) not null,    
    xmachtype_id      int,
    totalvalue        decimal(10,2),
    description       varchar(255),
    constraint xorderitem_pk primary key (xorderitem_id),
    constraint xoreritem_xorder_fk foreign key (xorder_id) references xorder on delete cascade,
    constraint xorderitem_xmachtype_fk foreign key (xmachtype_id) references xmachtype
);

create cached table xsupplier
(
    xsupplier_id     int generated by default as identity (start with 1),
    companyname      varchar(64)  not null,
    contactperson    varchar(64),
    productdesc      varchar(512) not null,
    phone            varchar(64),
    fax              varchar(32),
    cell             varchar(64),
    email            varchar(128),
    vatnr            varchar(32),
    company_regnr    varchar(32),
    address          varchar(255),
    banking          varchar(255),
    credit_limit     int,
    constraint xsupplier_pk primary key (xsupplier_id)
);

create cached table xpaidmethod
(
    xpaidmethod_id   int generated by default as identity (start with 1),
    method           varchar(32) not null,
    constraint xpaidmethod_pk primary key (xpaidmethod_id)
);

insert into xpaidmethod values (1, 'Cash Purchase');
insert into xpaidmethod values (2, 'Cheque');
insert into xpaidmethod values (3, 'Electronic Bank Transfer');
insert into xpaidmethod values (4, 'On Account (not Paid)');
insert into xpaidmethod values (5, 'On Account (Paid)');




create cached table xconsume
(
    xconsume_id       int generated by default as identity (start with 1),
    xsupplier_id      int not null,
    xmachine_id       int not null,
    requester_id      int not null,
    invoicedate       date,
    invoicenumber     varchar(16),
    authorizer_id     int,
    collector_id      int,
    description       varchar(255),
    partnumber        varchar(64),
    amount_liters     int,
    amount_rands      decimal(10,2),
    payer_id          int,
    xpaidmethod_id    int not null,  
    chequenumber      varchar(32),
    accnum            varchar(16),
    xsite_id          int,
    constraint xconsume_pk primary key (xconsume_id),
    constraint xconsume_xsupplier_fk foreign key (xsupplier_id) references xsupplier,
    constraint xconsume_xmachine_fk foreign key (xmachine_id) references xmachine,
    constraint xconsume_xemployee_fk foreign key (requester_id) references xemployee,
    constraint xconsume_xemployee_fk2 foreign key (authorizer_id) references xemployee,
    constraint xconsume_xemployee_fk3 foreign key (collector_id) references xemployee,
    constraint xconsume_xemployee_fk4 foreign key (payer_id) references xemployee,
    constraint xconsume_xpaidmethod_fk foreign key (xpaidmethod_id) references xpaidmethod,
    constraint xconsume_xsite_fk foreign key (xsite_id) references xsite
);

create cached table xbreakdown
(
    xbreakdown_id     int generated by default as identity (start with 1),
    breakdowndate     date,
    xmachine_id       int not null,
    xsite_id          int not null,
    reportedto_id     int,
    reportedby_id     int,
    attendedby_id     int,
    vehicle_id        int,
    repairdate        date,
    repaired          smallint,
    operatorfault     smallint,
    operator_id       int,
    km2site1way       decimal(6,2),
    hoursonjob        decimal(6,2),
    timeleft          time,
    timeback          time,
    stayedover        smallint,
    accomprice        int,
    invoicenumber     varchar(16),
    amount            decimal(10,2),
    standing_hours    decimal(4,2),
    constraint xbreakdown_pk primary key (xbreakdown_id),
    constraint xbreakdown_xmachine_fk foreign key (xmachine_id) references xmachine,
    constraint xbreakdown_xsite_fk foreign key (xsite_id) references xsite,
    constraint xbreakdown_xemployee_fk foreign key (reportedto_id) references xemployee,
    constraint xbreakdown_xemployee_fk2 foreign key (reportedby_id) references xemployee,
    constraint xbreakdown_xemployee_fk3 foreign key (attendedby_id) references xemployee,
    constraint xbreakdown_xmachine_fk2 foreign key (vehicle_id) references xmachine,
    constraint xbreakdown_xemployee_fk4 foreign key (operator_id) references xemployee
);

create cached table xbreakconsume
(
    xbreakconsume_id  int generated by default as identity (start with 1),
    xconsume_id       int not null,
    xbreakdown_id     int not null,
    constraint xbreakconsume_pk primary key (xbreakconsume_id),
    constraint xbreakconsume_xconsume_fk foreign key (xconsume_id) references xconsume,
    constraint xbreakconsume_xbreakdown_fk foreign key (xbreakdown_id) references xbreakdown on delete cascade
);

create cached table xfuel
(
    xfuel_id     int generated by default as identity (start with 1),
    fdate        date,
    ammount      decimal(10,2),
    liters       int,
    xsite_id     int,
    issuedby_id  int,
    issuedto_id  int,
    xsupplier_id int,
    iscache      bit,
    constraint xfuel_id primary key (xfuel_id),
    constraint xfuel_xsite_fk foreign key (xsite_id) references xsite,
    constraint xfuel_xemployee_fk foreign key (issuedby_id) references xemployee,
    constraint xfuel_xemployee_fk2 foreign key (issuedto_id) references xemployee,
    constraint xfuel_xsupplier_fk foreign key (xsupplier_id) references xsupplier
);

create cached table xpayment
(
    xpayment_id  int generated by default as identity (start with 1),
    xsupplier_id int not null,		
    paydate      date not null,
    ammount      decimal(10,2) not null,
    paidfrom     int not null,
    paydby_id    int,
    constraint xpayment_pk primary key (xpayment_id),
    constraint xpayment_xsupplier_fk foreign key (xsupplier_id) references xsupplier,
    constraint xpayment_xemployee_fk foreign key (paydby_id) references xemployee
);

create cached table xabsenteeism
(
    xabsenteeism_id int generated by default as identity (start with 1),
    xemployee_id    int not null,
    absentdate      date not null,
    xsite_id        int not null,
    xmachine_id     int,
    standing        bit,
    reportedby_id   int,
    reportedto_id   int,
    notcommunicated bit,
    permgranted     bit,
    grantedby_id    int,
    reason          varchar(1024),
    medical_cond    bit,
    funeral         bit,
    family_problem  bit,
    in_jail         bit,
    pdp_expired     bit,
    license_problem bit,
    ppe_safety      bit,
    wage_dispute    bit,
    drunk_on_site   bit,
    work_accident   bit,
    no_reason       bit,
    medical_cert    bit,
    death_cert      bit,
    constraint xabsenteeism_pk primary key (xabsenteeism_id),
    constraint xabsenteeism_xemployee_fk foreign key (xemployee_id) references xemployee on delete cascade,
    constraint xabsenteeism_xsite_fk foreign key (xsite_id) references xsite on delete cascade,
    constraint xabsenteeism_xmachine_fk foreign key (xmachine_id) references xmachine,
    constraint xabsenteeism_xemployee_fk2 foreign key (reportedby_id) references xemployee on delete cascade,
    constraint xabsenteeism_xemployee_fk3 foreign key (reportedto_id) references xemployee on delete cascade,
    constraint xabsenteeism_xemployee_fk4 foreign key (grantedby_id) references xemployee on delete cascade
);

create cached table xtripsheet
(
    xtripsheet_id int generated by default as identity (start with 1),
    tripdate      date not null,
    xlowbed_id    int not null,
    driver_id     int not null,
    authorized_id int not null,
    constraint xtripsheet_pk primary key (xtripsheet_id),
    constraint xtripsheet_xlowbed_fk foreign key (xlowbed_id) references xlowbed,
    constraint xtripsheet_xemployee_fk foreign key (driver_id) references xemployee,
    constraint xtripsheet_xemployee_fk2 foreign key (authorized_id) references xemployee
);

create cached table xtripsheetpart
(
    xtripsheetpart_id int generated by default as identity (start with 1),
    xtripsheet_id     int not null,
    partdate          date not null,
    fromsite_id       int,
    tosite_id         int,
    fromplace         varchar(64),
    toplace           varchar(64),
    loaded1_id        int,
    loaded2_id        int,
    loaded1           varchar(64),
    loaded2           varchar(64),
    isempty           bit,
    timestart         time,
    timeend           time,
    kilimeters        int,
    assistant_id      int, 
    constraint xtripsheetpart_fk primary key (xtripsheetpart_id),
    constraint xtripsheetpart_xtripsheet_fk foreign key (xtripsheet_id) references xtripsheet on delete cascade,
    constraint xtripsheetpart_xsite_fk foreign key (fromsite_id) references xsite,
    constraint xtripsheetpart_xsite_fk2 foreign key (tosite_id) references xsite,
    constraint xtripsheetpart_xmachine_fk foreign key (loaded1_id) references xmachine,
    constraint xtripsheetpart_xmachine_fk2 foreign key (loaded2_id) references xmachine,
    constraint xtripsheetpart_xemployee_fk foreign key (assistant_id) references xemployee
);

create cached table xaccounts
(
    xaccount_id       int generated by default as identity (start with 1),
    accname           varchar(32) not null,
    accnumber         varchar(12) not null,
    bank              varchar(32) not null,
    branch            varchar(32) not null,
    constraint xaccount_pk primary key (xaccount_id)
);

create cached table xbankbalance
(
    xbankbalance_id  int generated by default as identity (start with 1),
    balancedate      timestamp not null,
    totalvalue       decimal(12,2),
    constraint xbankbalance_pk primary key (xbankbalance_id)
);

create cached table xbankbalancepart
(
   xbankbalancepart_id int generated by default as identity (start with 1),
   xbankbalance_id     int not null,
   xaccount_id         int not null,
   total               decimal(10,2),
   constraint xbankbalancepart_pk primary key (xbankbalancepart_id),
   constraint xbankbalancepart_xbankbalance_fk foreign key (xbankbalance_id) references xbankbalance on delete cascade,
   constraint xbankbalancepart_xaccounts_fk foreign key (xaccount_id) references xaccounts
);

create cached table xsitediary
(
    xsitediary_id    int generated by default as identity (start with 1),
    diarydate        date not null,
    weekend          date not null,
    xsite_id         int not null,
    manager_id       int not null,
    site_foreman     varchar(32),
    site_number      varchar(32),
    constraint xsitediary_pk primary key (xsitediary_id),
    constraint xsitediary_xsite_fk foreign key (xsite_id) references xsite,
    constraint xsitediary_xemployee_fk foreign key (manager_id) references xemployee
);

create cached table xsitediaryitem
(
    xsitediaryitem_id  int generated by default as identity (start with 1),
    xsitediary_id      int not null,
    xmachine_id        int not null,
    operator_id        int not null,
    day1value          varchar(6),
    day2value          varchar(6),
    day3value          varchar(6),
    day4value          varchar(6),
    day5value          varchar(6),
    day6value          varchar(6),
    day7value          varchar(6),
    constraint xsitediaryitem_pk primary key (xsitediaryitem_id),
    constraint xsitediaryitem_xsitediary_fk foreign key (xsitediary_id) references xsitediary on delete cascade,
    constraint xsitediaryitem_xmachine_fk foreign key (xmachine_id) references xmachine,
    constraint xsitediaryitem_xemployee_fk foreign key (operator_id) references xemployee
);

create cached table xappforleave
(
    xappforleave_id  int generated by default as identity (start with 1),
    appdate          date not null,
    applicant_id     int not null,
    is_sickleave     bit,
    is_annualleave   bit,
    is_specialleave  bit,
    is_unpaidleave   bit,
    fromdate         date,
    todate           date,
    days             int,
    is_signed        bit,
    is_approved      bit,
    approvedby_id    int,
    remarks          varchar(1024),
    constraint xappforleave_pk primary key (xappforleave_id),
    constraint xappforleave_xemployee_fk foreign key (applicant_id) references xemployee,
    constraint xappforleave_xemployee_fk2 foreign key (approvedby_id) references xemployee
);

create cached table xloans
(
    xloans_id        int generated by default as identity (start with 1),
    loandate         date not null,
    is_loan          bit,
    is_advance       bit,
    is_transport     bit,
    requestedby_id   int not null,
    authorizedby_id  int,
    issueddate       date,
    deductstartdate  date,
    amount           decimal(10,2) not null,
    deduction        decimal(10,2) not null,
    deducttime       int,
    is_signed        bit,
    constraint xloans_pk primary key (xloans_id),
    constraint xloans_xemployee_fk foreign key (requestedby_id) references xemployee,
    constraint xloans_xemployee_fk2 foreign key (authorizedby_id) references xemployee
);

create cached table xincidents
(
    xincidents_id    int generated by default as identity (start with 1),
    reportdate       date not null,
    incidentdate     date not null,
    xsite_id         int,
    blobmachines    varchar(512),
    blobpeople      varchar(512),
    location         varchar(255),
    description      varchar(1024) not null,
    damages          varchar(1024) not null,
    estimated_cost   int not null,
    reportedby_id    int,
    reportedto_id    int,
    is_signed        bit,
    is_verified      bit,
    verifiedby_id    int,
    lost_income      int,
    constraint xincidents_pk primary key (xincidents_id),
    constraint xincidents_xsite_fk foreign key (xsite_id) references xsite,
    constraint xincidents_xemployee_fk foreign key (reportedby_id) references xemployee,
    constraint xincidents_xemployee_fk2 foreign key (reportedto_id) references xemployee,
    constraint xincidents_xemployee_fk3 foreign key (verifiedby_id) references xemployee
);

create cached table xmachineincident
(
    xmachineincident_id int generated by default as identity (start with 1),
    xincidents_id    int not null,
    xmachine_id      int not null,
    constraint xmachineincident_pk primary key (xmachineincident_id),
    constraint xmachineincident_xincidents_fk foreign key (xincidents_id) references xincidents on delete cascade,
    constraint xmachineincident_xmachine_fk foreign key (xmachine_id) references xmachine on delete cascade
);

create cached table xemployeeincident
(
    xemployeeincident_id int generated by default as identity (start with 1),
    xincidents_id        int not null,
    xemployee_id         int not null,
    constraint xemployeeincident_pk primary key (xemployeeincident_id),
    constraint xemployeeincident_xincidents_fk foreign key (xincidents_id) references xincidents on delete cascade,
    constraint xemployeeincident_xemployee_fk foreign key (xemployee_id) references xemployee on delete cascade
);

create cached table xsalarylist
(
    xsalarylist_id int generated by default as identity (start with 1),
    payday         date not null,
    constraint xsalarylist_pk primary key (xsalarylist_id)
);

create cached table xsalary
(
    xsalary_id     int generated by default as identity (start with 1),
    xsalarylist_id int not null,
    xemployee_id   int not null,
    amount         decimal(10,2) not null,
    constraint xsalarylist_pk primary key (xsalary_id),
    constraint xsalary_xsalarylist_fk foreign key (xsalarylist_id) references xsalarylist on delete cascade,
    constraint xsalary_xemployee_fk foreign key (xemployee_id) references xemployee
);

create cached table xopclocksheet
(
    xopclocksheet_id int generated by default as identity (start with 1),
    xemployee_id     int not null,
    xsite_id         int not null,
    sheet_date       date,
    xmachine_id      int not null,
    km_start1        decimal(10,2),
    km_stop1         decimal(10,2),
    work_from1       time,
    work_to1         time,
    stand_from1      time,
    stand_to1        time,
    reason1          varchar(255),
    km_start2        decimal(10,2),
    km_stop2         decimal(10,2),
    work_from2       time,
    work_to2         time,
    stand_from2      time,
    stand_to2        time,
    reason2          varchar(255),
    km_start3        decimal(10,2),
    km_stop3         decimal(10,2),
    work_from3       time,
    work_to3         time,
    stand_from3      time,
    stand_to3        time,
    reason3          varchar(255),
    km_start4        decimal(10,2),
    km_stop4         decimal(10,2),
    work_from4       time,
    work_to4         time,
    stand_from4      time,
    stand_to4        time,
    reason4          varchar(255),
    km_start5        decimal(10,2),
    km_stop5         decimal(10,2),
    work_from5       time,
    work_to5         time,
    stand_from5      time,
    stand_to5        time,
    reason5          varchar(255),
    km_start6        decimal(10,2),
    km_stop6         decimal(10,2),
    work_from6       time,
    work_to6         time,
    stand_from6      time,
    stand_to6        time,
    reason6          varchar(255),
    km_start7        decimal(10,2),
    km_stop7         decimal(10,2),
    work_from7       time,
    work_to7         time,
    stand_from7      time,
    stand_to7        time,
    reason7          varchar(255),
    constraint xopclocksheet_pk primary key (xopclocksheet_id),
    constraint xopclocksheet_xemployee_fk foreign key (xemployee_id) references xemployee,
    constraint xopclocksheet_xsite_fk foreign key (xsite_id) references xsite,
    constraint xopclocksheet_xmachine_fk foreign key (xmachine_id) references xmachine
);

create cached table xjobcard
(
    xjobcard_id      int generated by default as identity (start with 1),
    xemployee_id     int not null,
    carddate         date not null,
    week_ending      date not null,
    job1_day1        varchar(255),
    job2_day1        varchar(255),
    job3_day1        varchar(255),
    job4_day1        varchar(255),
    job5_day1        varchar(255),
    machine_id1_day1 int,
    machine_id2_day1 int,
    machine_id3_day1 int,
    machine_id4_day1 int,
    machine_id5_day1 int,
    job1_day2        varchar(255),
    job2_day2        varchar(255),
    job3_day2        varchar(255),
    job4_day2        varchar(255),
    job5_day2        varchar(255),
    machine_id1_day2 int,
    machine_id2_day2 int,
    machine_id3_day2 int,
    machine_id4_day2 int,
    machine_id5_day2 int,
    job1_day3        varchar(255),
    job2_day3        varchar(255),
    job3_day3        varchar(255),
    job4_day3        varchar(255),
    job5_day3        varchar(255),
    machine_id1_day3 int,
    machine_id2_day3 int,
    machine_id3_day3 int,
    machine_id4_day3 int,
    machine_id5_day3 int,
    job1_day4        varchar(255),
    job2_day4        varchar(255),
    job3_day4        varchar(255),
    job4_day4        varchar(255),
    job5_day4        varchar(255),
    machine_id1_day4 int,
    machine_id2_day4 int,
    machine_id3_day4 int,
    machine_id4_day4 int,
    machine_id5_day4 int,
    job1_day5        varchar(255),
    job2_day5        varchar(255),
    job3_day5        varchar(255),
    job4_day5        varchar(255),
    job5_day5        varchar(255),
    machine_id1_day5 int,
    machine_id2_day5 int,
    machine_id3_day5 int,
    machine_id4_day5 int,
    machine_id5_day5 int,
    job1_day6        varchar(255),
    job2_day6        varchar(255),
    job3_day6        varchar(255),
    job4_day6        varchar(255),
    job5_day6        varchar(255),
    machine_id1_day6 int,
    machine_id2_day6 int,
    machine_id3_day6 int,
    machine_id4_day6 int,
    machine_id5_day6 int,
    job1_day7        varchar(255),
    job2_day7        varchar(255),
    job3_day7        varchar(255),
    job4_day7        varchar(255),
    job5_day7        varchar(255),
    machine_id1_day7 int,
    machine_id2_day7 int,
    machine_id3_day7 int,
    machine_id4_day7 int,
    machine_id5_day7 int,
    vehicle_id1_day1 int,
    vehicle_id2_day1 int,
    vehicle_id3_day1 int,
    vehicle_id4_day1 int,
    vehicle_id5_day1 int,
    vehicle_id1_day2 int,
    vehicle_id2_day2 int,
    vehicle_id3_day2 int,
    vehicle_id4_day2 int,
    vehicle_id5_day2 int,
    vehicle_id1_day3 int,
    vehicle_id2_day3 int,
    vehicle_id3_day3 int,
    vehicle_id4_day3 int,
    vehicle_id5_day3 int,
    vehicle_id1_day4 int,
    vehicle_id2_day4 int,
    vehicle_id3_day4 int,
    vehicle_id4_day4 int,
    vehicle_id5_day4 int,
    vehicle_id1_day5 int,
    vehicle_id2_day5 int,
    vehicle_id3_day5 int,
    vehicle_id4_day5 int,
    vehicle_id5_day5 int,
    vehicle_id1_day6 int,
    vehicle_id2_day6 int,
    vehicle_id3_day6 int,
    vehicle_id4_day6 int,
    vehicle_id5_day6 int,
    vehicle_id1_day7 int,
    vehicle_id2_day7 int,
    vehicle_id3_day7 int,
    vehicle_id4_day7 int,
    vehicle_id5_day7 int,
    constraint xjobcard_pk primary key (xjobcard_id),
    constraint xjobcard_xemployee_fk foreign key (xemployee_id) references xemployee,
    constraint xjobcard_xmachine_fk11 foreign key (machine_id1_day1) references xmachine,
    constraint xjobcard_xmachine_fk21 foreign key (machine_id2_day1) references xmachine,
    constraint xjobcard_xmachine_fk31 foreign key (machine_id3_day1) references xmachine,
    constraint xjobcard_xmachine_fk41 foreign key (machine_id4_day1) references xmachine,
    constraint xjobcard_xmachine_fk51 foreign key (machine_id5_day1) references xmachine,
    constraint xjobcard_xmachine_fk12 foreign key (machine_id1_day2) references xmachine,
    constraint xjobcard_xmachine_fk22 foreign key (machine_id2_day2) references xmachine,
    constraint xjobcard_xmachine_fk32 foreign key (machine_id3_day2) references xmachine,
    constraint xjobcard_xmachine_fk42 foreign key (machine_id4_day2) references xmachine,
    constraint xjobcard_xmachine_fk52 foreign key (machine_id5_day2) references xmachine,
    constraint xjobcard_xmachine_fk13 foreign key (machine_id1_day3) references xmachine,
    constraint xjobcard_xmachine_fk23 foreign key (machine_id2_day3) references xmachine,
    constraint xjobcard_xmachine_fk33 foreign key (machine_id3_day3) references xmachine,
    constraint xjobcard_xmachine_fk43 foreign key (machine_id4_day3) references xmachine,
    constraint xjobcard_xmachine_fk53 foreign key (machine_id5_day3) references xmachine,
    constraint xjobcard_xmachine_fk14 foreign key (machine_id1_day4) references xmachine,
    constraint xjobcard_xmachine_fk24 foreign key (machine_id2_day4) references xmachine,
    constraint xjobcard_xmachine_fk34 foreign key (machine_id3_day4) references xmachine,
    constraint xjobcard_xmachine_fk44 foreign key (machine_id4_day4) references xmachine,
    constraint xjobcard_xmachine_fk54 foreign key (machine_id5_day4) references xmachine,
    constraint xjobcard_xmachine_fk15 foreign key (machine_id1_day5) references xmachine,
    constraint xjobcard_xmachine_fk25 foreign key (machine_id2_day5) references xmachine,
    constraint xjobcard_xmachine_fk35 foreign key (machine_id3_day5) references xmachine,
    constraint xjobcard_xmachine_fk45 foreign key (machine_id4_day5) references xmachine,
    constraint xjobcard_xmachine_fk55 foreign key (machine_id5_day5) references xmachine,
    constraint xjobcard_xmachine_fk16 foreign key (machine_id1_day6) references xmachine,
    constraint xjobcard_xmachine_fk26 foreign key (machine_id2_day6) references xmachine,
    constraint xjobcard_xmachine_fk36 foreign key (machine_id3_day6) references xmachine,
    constraint xjobcard_xmachine_fk46 foreign key (machine_id4_day6) references xmachine,
    constraint xjobcard_xmachine_fk56 foreign key (machine_id5_day6) references xmachine,
    constraint xjobcard_xmachine_fk17 foreign key (machine_id1_day7) references xmachine,
    constraint xjobcard_xmachine_fk27 foreign key (machine_id2_day7) references xmachine,
    constraint xjobcard_xmachine_fk37 foreign key (machine_id3_day7) references xmachine,
    constraint xjobcard_xmachine_fk47 foreign key (machine_id4_day7) references xmachine,
    constraint xjobcard_xmachine_fk57 foreign key (machine_id5_day7) references xmachine,
    constraint xjobcard_xmachine_fk011 foreign key (vehicle_id1_day1) references xmachine,
    constraint xjobcard_xmachine_fk021 foreign key (vehicle_id2_day1) references xmachine,
    constraint xjobcard_xmachine_fk031 foreign key (vehicle_id3_day1) references xmachine,
    constraint xjobcard_xmachine_fk041 foreign key (vehicle_id4_day1) references xmachine,
    constraint xjobcard_xmachine_fk051 foreign key (vehicle_id5_day1) references xmachine,
    constraint xjobcard_xmachine_fk012 foreign key (vehicle_id1_day2) references xmachine,
    constraint xjobcard_xmachine_fk022 foreign key (vehicle_id2_day2) references xmachine,
    constraint xjobcard_xmachine_fk032 foreign key (vehicle_id3_day2) references xmachine,
    constraint xjobcard_xmachine_fk042 foreign key (vehicle_id4_day2) references xmachine,
    constraint xjobcard_xmachine_fk052 foreign key (vehicle_id5_day2) references xmachine,
    constraint xjobcard_xmachine_fk013 foreign key (vehicle_id1_day3) references xmachine,
    constraint xjobcard_xmachine_fk023 foreign key (vehicle_id2_day3) references xmachine,
    constraint xjobcard_xmachine_fk033 foreign key (vehicle_id3_day3) references xmachine,
    constraint xjobcard_xmachine_fk043 foreign key (vehicle_id4_day3) references xmachine,
    constraint xjobcard_xmachine_fk053 foreign key (vehicle_id5_day3) references xmachine,
    constraint xjobcard_xmachine_fk014 foreign key (vehicle_id1_day4) references xmachine,
    constraint xjobcard_xmachine_fk024 foreign key (vehicle_id2_day4) references xmachine,
    constraint xjobcard_xmachine_fk034 foreign key (vehicle_id3_day4) references xmachine,
    constraint xjobcard_xmachine_fk044 foreign key (vehicle_id4_day4) references xmachine,
    constraint xjobcard_xmachine_fk054 foreign key (vehicle_id5_day4) references xmachine,
    constraint xjobcard_xmachine_fk015 foreign key (vehicle_id1_day5) references xmachine,
    constraint xjobcard_xmachine_fk025 foreign key (vehicle_id2_day5) references xmachine,
    constraint xjobcard_xmachine_fk035 foreign key (vehicle_id3_day5) references xmachine,
    constraint xjobcard_xmachine_fk045 foreign key (vehicle_id4_day5) references xmachine,
    constraint xjobcard_xmachine_fk055 foreign key (vehicle_id5_day5) references xmachine,
    constraint xjobcard_xmachine_fk016 foreign key (vehicle_id1_day6) references xmachine,
    constraint xjobcard_xmachine_fk026 foreign key (vehicle_id2_day6) references xmachine,
    constraint xjobcard_xmachine_fk036 foreign key (vehicle_id3_day6) references xmachine,
    constraint xjobcard_xmachine_fk046 foreign key (vehicle_id4_day6) references xmachine,
    constraint xjobcard_xmachine_fk056 foreign key (vehicle_id5_day6) references xmachine,
    constraint xjobcard_xmachine_fk017 foreign key (vehicle_id1_day7) references xmachine,
    constraint xjobcard_xmachine_fk027 foreign key (vehicle_id2_day7) references xmachine,
    constraint xjobcard_xmachine_fk037 foreign key (vehicle_id3_day7) references xmachine,
    constraint xjobcard_xmachine_fk047 foreign key (vehicle_id4_day7) references xmachine,
    constraint xjobcard_xmachine_fk057 foreign key (vehicle_id5_day7) references xmachine
);

create cached table xhourcompare
(
    xhourcompare_id int generated by default as identity (start with 1),
    month_year      date,
    xsite_id        int not null,
    operator_id     int not null,
    xmachine_id     int not null,
    constraint xhourcompare_pk primary key (xhourcompare_id),
    constraint xhourcompare_xsite_fk foreign key (xsite_id) references xsite,
    constraint xhourcompare_xemployee_fk foreign key (operator_id) references xemployee,
    constraint xhourcompare_xmachine_fk foreign key (xmachine_id) references xmachine
);

create cached table xhourcompareday
(
    xhourcompareday_id int generated by default as identity (start with 1),
    xhourcompare_id    int not null,
    day_no             int not null,
    ocs                double,
    hm                 double,
    dr                 double,
    std                double,
    tsh                double,
    tsn                double,
    invn               double,
    constraint xhourcompareday_pk primary key (xhourcompareday_id),
    constraint xhourcompareday_xhourcompare_fk foreign key (xhourcompare_id) references xhourcompare
);


---------------------------------------------------------------------------------------
create table cbitems
(
  cbitem_id     int generated by default as identity (start with 1),
  name          varchar(12) not null, 
  id            int not null, 
  val           varchar(32),
  constraint cbitems_pk primary key (cbitem_id)
);

create unique index cbitems_uniq_idx on cbitems (name, id);

insert into cbitems values(1,'paidfrom',0,'Unknown');
insert into cbitems values(2,'paidfrom',1,'TO MACHINE AND TRUCK');
insert into cbitems values(3,'paidfrom',2,'TO TRUCK SALES');
insert into cbitems values(4,'paidfrom',3,'T&F CONSTRUCTION');
insert into cbitems values(5,'paidfrom',4,'XLEND PLANT');
insert into cbitems values(6,'paidfrom',5,'EACSA');
insert into cbitems values(7,'wage_category',1,'Xlend Salaries');
insert into cbitems values(8,'wage_category',2,'Xlend Wages');
insert into cbitems values(9,'wage_category',3,'T&F Wages');
insert into cbitems values(10,'wage_category',4,'Casual Wages');

insert into cbitems values(11,'rated_machines',1,'6m Tipper');
insert into cbitems values(12,'rated_machines',2,'10m Tipper');
insert into cbitems values(13,'rated_machines',3,'Dumper Truck');
insert into cbitems values(14,'rated_machines',4,'10 000L Watercart');
insert into cbitems values(15,'rated_machines',5,'14 000L Watercart');
insert into cbitems values(16,'rated_machines',6,'Lowbed 3 axle');
insert into cbitems values(17,'rated_machines',7,'Lowbed 2 axle');
insert into cbitems values(18,'rated_machines',8,'Lowbed 1 axle');
insert into cbitems values(19,'rated_machines',9,'Bobcat');
insert into cbitems values(20,'rated_machines',10,'Bobcat With Broom Attachment');
insert into cbitems values(21,'rated_machines',11,'Bobcat With Excavator Attachment');
insert into cbitems values(22,'rated_machines',12,'Small Roller');
insert into cbitems values(23,'rated_machines',13,'Smooth Drum Roller');
insert into cbitems values(24,'rated_machines',14,'Padfoot Roller');
insert into cbitems values(25,'rated_machines',15,'D4 Dozer');
insert into cbitems values(26,'rated_machines',17,'D65 Dozer');
insert into cbitems values(27,'rated_machines',18,'TLB');
insert into cbitems values(28,'rated_machines',19,'TLB with Pecker');
insert into cbitems values(29,'rated_machines',20,'Front End Loader');
insert into cbitems values(30,'rated_machines',21,'Excavator 20T');
insert into cbitems values(31,'rated_machines',22,'Excavator 30T');
insert into cbitems values(32,'rated_machines',23,'Grader');
insert into cbitems values(33,'site_types',1,'Work Site');
insert into cbitems values(34,'site_types',2,'Additional');
insert into cbitems values(35,'site_types',3,'DEPOT');


create cached table xmachrentalrate
(
    xmachrentalrate_id int generated by default as identity (start with 1),
    actual_date        date,
    diesel_price       decimal(6,2),
    factor             decimal(6,2),
    constraint xmachinerentalrate_pk primary key (xmachrentalrate_id)
);

create cached table xmachrentalrateitm
(
    xmachrentalrateitm_id  int generated by default as identity (start with 1),
    xmachrentalrate_id     int not null,
    xmachtype_id           int not null,
    litres_hour            decimal(8,2) not null,
    dry                    decimal(8,2) not null,
    real_wet               decimal(8,2) not null,
    good_wet               decimal(8,2) not null,
    constraint xmachrentalrateitm_pk primary key (xmachrentalrateitm_id),
    constraint xmachrentalrateitm_xmachrentalrate_fk foreign key (xmachrentalrate_id) references xmachrentalrate on delete cascade,
    constraint xmachrentalrateitm_xmachtype_fk foreign key (xmachtype_id) references xmachtype on delete cascade
);

create cached table xtransscheduleitm
(
    xtransscheduleitm_id   int generated by default as identity (start with 1),
    machine_id             int not null,
    site_from_id           int not null,
    site_to_id             int not null,
    date_required          date,
    date_move              date,
    lowbed_id              int,
    operator_id            int,
    is_completed           bit,
    constraint xtransscheduleitm_pk primary key (xtransscheduleitm_id),
    constraint xtransscheduleitm_xmachine_fk foreign key (machine_id) references xmachine,
    constraint xtransscheduleitm_xsite_fk foreign key (site_from_id) references xsite,
    constraint xtransscheduleitm_xsite_fk2 foreign key (site_to_id) references xsite,
    constraint xtransscheduleitm_xmachine_fk2 foreign key (lowbed_id) references xlowbed,
    constraint xtransscheduleitm_xemployee_fk foreign key (operator_id) references xemployee
);

create cached table xopmachassing
(
    xopmachassing_id int generated by default as identity (start with 1),
    xsite_id         int not null,
    xemployee_id     int,
    xmachine_id      int,
    date_start       date not null,
    date_end         date,
    constraint xopmachassing_pk primary key (xopmachassing_id),
    constraint xopmachassing_xsite_fk foreign key (xsite_id) references xsite,
    constraint xopmachassing_xemployee_fk foreign key (xemployee_id) references xemployee on delete cascade,
    constraint xopmachassing_xmachine_fk foreign key (xmachine_id) references xmachine
);

create unique index xopmachassing_uniq_idx on xopmachassing (date_start, xsite_id, xemployee_id, xmachine_id);

--select date_required \"Date\", count(*) \"Qty\" from xtransscheduleitm group by date_required

create cached table xpartcategory
(
    xpartcategory_id int generated by default as identity (start with 1),
    group_id         int not null,
    name             varchar(64) not null,
    parent_id        int,
    constraint xpartcategory_pk primary key (xpartcategory_id),
--    constraint xpartcategory_xpartcategory_fk foreign key (parent_id) references xpartcategory
);

create unique index xpartcategory_uniq_idx on xpartcategory (group_id, name);

create cached table xparts
(
    xparts_id       int generated by default as identity (start with 1),
    partnumber      varchar(32) not null,
    description     varchar(128) not null,
    storename       varchar(64) not null,
    machinemodel    varchar(64),
    quantity        decimal(10,2) not null,
    lastsupplier_id int,
    prevsupplier_id int,
    priceperunit    decimal(10,2) not null,
    purchased       date,
    xpartcategory_id int not null,
    constraint xparts_pk primary key (xparts_id),
    constraint xparts_xsupplier_fk foreign key (lastsupplier_id) references xsupplier (xsupplier_id),
    constraint xparts_xsupplier_fk2 foreign key (prevsupplier_id) references xsupplier (xsupplier_id),
    constraint xparts_xpartcategory_fk foreign key (xpartcategory_id) references xpartcategory (xpartcategory_id),
    constraint valid_quantity check (quantity>=0)
);

create table xbookouts
(
    xbookouts_id    int generated by default as identity (start with 1),
    xparts_id       int not null,
    issue_date      date not null,
    xsite_id        int not null,
    xmachine_id     int not null,
    issuedby_id     int not null,
    issuedto_id     int not null,
    quantity        decimal(10,2) not null,
    constraint xbookouts_pk primary key (xbookouts_id),
    constraint xbookouts_xparts_fk foreign key (xparts_id) references xparts (xparts_id) on delete cascade,
    constraint xbookouts_xmachine_fk foreign key (xmachine_id) references xmachine (xmachine_id),
    constraint xbookouts_xemployee_fk foreign key (issuedby_id) references xemployee (xemployee_id),
    constraint xbookouts_xemployee_fk2 foreign key (issuedto_id) references xemployee (xemployee_id)
);

create table xaddstocks
(
    xaddstocks_id   int generated by default as identity (start with 1),
    xparts_id       int not null,
    purchase_date   date not null,
    enteredby_id    int not null,
    xsupplier_id    int not null,
    priceperunit    decimal(10,2) not null,
    quantity        decimal(10,2) not null,
    constraint xaddstocks_pk primary key (xaddstocks_id),
    constraint xaddstocks_xparts_fk foreign key (xparts_id) references xparts (xparts_id) on delete cascade,
    constraint xaddstocks_xemployee_fk foreign key (enteredby_id) references xemployee (xemployee_id),
    constraint xaddstocks_xsupplier_fk foreign key (xsupplier_id) references xsupplier (xsupplier_id)
);

create table xppetype
(
    xppetype_id    int generated by default as identity (start with 1),
    xppetype       varchar(64) not null,
    stocklevel     int not null default 0,
    constraint xppetype_pk primary key (xppetype_id)
);

create table xppebuy
(
    xppebuy_id      int generated by default as identity (start with 1),
    buydate         date not null,
    boughtby_id     int not null,
    xsupplier_id    int not null,
    authorizedby_id int not null,
    constraint xppebuy_pk primary key (xppebuy_id),
    constraint xppebuy_xemployee_fk foreign key (boughtby_id) references xemployee (xemployee_id),
    constraint xppebuy_xsupplier_fk foreign key (xsupplier_id) references xsupplier (xsupplier_id),
    constraint xppebuy_xemployee_fk2 foreign key (authorizedby_id) references xemployee (xemployee_id)
);

create table xppebuyitem
(
    xppebuyitem_id  int generated by default as identity (start with 1),
    xppebuy_id      int not null,
    xppetype_id     int not null,
    quantity        int not null,
    priceperunit    decimal (8,2),
    constraint xppebuyitem_pk primary key (xppebuyitem_id),
    constraint xppebuyitem_xppeby_fk foreign key (xppebuy_id) references xppebuy (xppebuy_id)
);

create table xppeissue
(
    xppeissue_id    int generated by default as identity (start with 1),
    issuedate       date not null,
    issuedby_id     int not null,
    issuedto_id     int not null,
    authorizedby_id int not null,
    constraint xppeissue_pk primary key (xppeissue_id),
    constraint xppeissue_xemployee_fk foreign key (issuedby_id) references xemployee (xemployee_id),
    constraint xppeissue_xemployee_fk2 foreign key (issuedto_id) references xemployee (xemployee_id),
    constraint xppeissue_xemployee_fk3 foreign key (authorizedby_id) references xemployee (xemployee_id)
);

create table xppeissueitem
(
    xppeissueitem_id int generated by default as identity (start with 1),
    xppeissue_id     int not null,
    xppetype_id     int not null,
    quantity        int not null,
    constraint xppeissueitem_pk primary key (xppeissueitem_id),
    constraint xppeissueitem_xppetype_fk foreign key (xppetype_id) references xppetype (xppetype_id),
    constraint xppeissueitem_xppeissue_fk foreign key (xppeissue_id) references xppeissue (xppeissue_id)
);

create table xmachservice
(
    xmachservice_id  int generated by default as identity (start with 1),
    servicedate      date not null,
    entrydate        date not null,
    servicedby_id    int not null,
    assistedby_id    int not null,
    xmachine_id      int not null,
    engine_oil       varchar(128),
    hydraulic_oil    varchar(128),
    brake_fluid      varchar(128),
    transmission_oil varchar(128),
    gearbox_oil      varchar(128),
    anti_freeze      varchar(128),
    diff_checked1    varchar(128),
    diff_checked2    varchar(128),
    diff_checked3    varchar(128),
    constraint xmachservice_pk primary key (xmachservice_id),
    constraint xmachservice_xemployee_fk foreign key (servicedby_id) references xemployee (xemployee_id),
    constraint xmachservice_xemployee_fk2 foreign key (assistedby_id) references xemployee (xemployee_id),
    constraint xmachservice_xmachine_fk foreign key (xmachine_id) references xmachine (xmachine_id)
);

create table xdieselcart
(
    xdieselcart_id   int generated by default as identity (start with 1),
    fleet_nr         int not null,
    reg_nr           varchar(32),
    expdate          date,
    litres           int not null,
    chassis_nr       varchar(32),
    assigned_id      int,
    photo            other,
    constraint xdieselcart_pk primary key (xdieselcart_id),
    constraint xdieselcart_xmachine_fk foreign key (assigned_id) references xmachine (xmachine_id)
);

create table xdieselpurchase
(
    xdieselpurchase_id int generated by default as identity (start with 1),
    xsupplier_id       int not null,
    purchase_date      date not null,
    litres             decimal(6,2) not null,
    rand_factor        decimal(5,2) not null,
    paid               decimal(8,2) not null,
    constraint xdieselpurchase_pk primary key (xdieselpurchase_id),
    constraint xdieselpurchase_xsupplier_fk foreign key (xsupplier_id) references xsupplier (xsupplier_id)
); 

create table xdieselcartissue
(
    xdieselcartissue_id int generated by default as identity (start with 1),
    issue_date          date not null,
    driver_id           int not null,
    xdieselcart_id      int not null,
    liters              decimal(6,2) not null,
    xsupplier_id        int not null,
    constraint xdieselcartissue_pk primary key (xdieselcartissue_id),
    constraint xdieselcartissue_xemployee_fk foreign key (driver_id) references xemployee (xemployee_id),
    constraint xdieselcartissue_xdieselcart_fk foreign key (xdieselcart_id) references xdieselcart (xdieselcart_id),
    constraint xdieselcartissue_xsupplier_fk foreign key (xsupplier_id) references xsupplier (xsupplier_id)
);

create table xdiesel2plant
(
    xdiesel2plant_id  int generated by default as identity (start with 1),
    xdieselcart_id    int not null,
    last_date         date,
    driver_id         int not null,
    constraint xdiesel2plant_pk primary key (xdiesel2plant_id),
    constraint xdiesel2plant_xdieselcart_fk foreign key (xdieselcart_id) references xdieselcart (xdieselcart_id),
    constraint xdiesel2plant_xemployee_fk foreign key (driver_id) references xemployee (xemployee_id)
);

create table xdiesel2plantitem
(
    xdiesel2plantitem_id int generated by default as identity (start with 1),
    xdiesel2plant_id     int not null,
    add_date             date not null,
    xmachine_id          int not null,
    xsite_id             int not null,
    operator_id          int not null,
    hour_meter           decimal(9,1) not null,
    issuedby_id          int not null,
    liters               decimal(6,2) not null,
    constraint xdiesel2plantitem_pk primary key (xdiesel2plantitem_id),
    constraint xdiesel2plantitem_xdiesel2plant_fk foreign key (xdiesel2plant_id) references xdiesel2plant (xdiesel2plant_id),
    constraint xdiesel2plantitem_xmachine_fk foreign key (xmachine_id) references xmachine (xmachine_id),
    constraint xdiesel2plantitem_xsite_fk foreign key (xsite_id) references xsite (xsite_id),
    constraint xdiesel2plantitem_xemployee_fk foreign key (operator_id) references xemployee (xemployee_id),
    constraint xdiesel2plantitem_xemployee_fk2 foreign key (issuedby_id) references xemployee (xemployee_id)
);

create table xbatterypurchase
(
    xbatterypurchase_id int generated by default as identity (start with 1),
    purchase_date       date not null,
    entry_date          date not null,
    purchased_by        int not null,
    xsupplier_id        int not null,
    invoice_vat_incl    decimal (8,2) not null,
    invoice_vat_excl    decimal (8,2) not null,
    constraint xbatterypurchase_pk primary key (xbatterypurchase_id),
    constraint xbatterypurchase_xsupplier_fk foreign key (xsupplier_id) references xsupplier (xsupplier_id)
);

create table xbateryissue
(
    xbateryissue_id     int generated by default as identity (start with 1),
    issue_date          date not null,
    entry_date          date not null,
    issued_by           int not null,
    issued_to           int not null,
    xmachine_id         int not null,
    constraint xbateryissue_pk primary key (xbateryissue_id),
    constraint xbateryissue_xemployee_fk foreign key (issued_by) references xemployee (xemployee_id),
    constraint xbateryissue_xemployee_fk2 foreign key (issued_to) references xemployee (xemployee_id),
    constraint xbateryissue_xmachine_fk foreign key (xmachine_id) references xmachine (xmachine_id)
);

create table xbattery
(
    xbattery_id         int generated by default as identity (start with 1),
    battery_code        varchar(32) not null,
    vat_excl_unit       decimal (6,2),
    battery_id          varchar(32),
    xbatterypurchase_id int not null,
    xbateryissue_id     int null,
    constraint xbattery_pk primary key (xbattery_id),
    constraint xbattery_xbatterypurchase_fk foreign key (xbatterypurchase_id) references xbatterypurchase (xbatterypurchase_id),
    constraint xbattery_xbateryissue_fk foreign key (xbateryissue_id) references xbateryissue (xbateryissue_id)
);

create table xpettycategory
(
    xpettycategory_id   int not null generated by default as identity (start with 1),
    category_name       varchar(64) not null,
    constraint xpettycategory_pk primary key (xpettycategory_id)
);

create table xpettybalance
(
    xpettybalance_id    int not null generated by default as identity (start with 1),
    curdate             date,
    in_amount           decimal(10,2),
    out_amount          decimal(10,2),
    constraint xpettybalance_pk primary key (xpettybalance_id)
);

create table xpetty
(
    xpetty_id           int generated by default as identity (start with 1),
    issue_date          date not null,
    xemployee_in_id     int not null,
    amount              decimal(9,2) not null,
    change_amt          decimal(9,2) not null,
    is_loan             bit default 0,
    is_petty            bit default 0,
    is_allowance        bit default 0,
    notes               text,
    receipt_date        date,
    xemployee_out_id    int,
    constraint xpetty_pk primary key (xpetty_id),
    constraint xpetty_xemployee_fk foreign key (xemployee_in_id) references xemployee (xemployee_id),
    constraint xpetty_xemployee_fk2 foreign key (xemployee_out_id) references xemployee (xemployee_id)
);

create table xpettyitem
(
    xpettyitem_id       int not null generated by default as identity (start with 1),
    xpetty_id           int not null,
    xpettycategory_id   int not null,
    amount              decimal(9,2) not null,
    xmachine_id         int null,
    xsite_id            int not null,
    stamp               timestamp,
    constraint xpettyitem_pk primary key (xpettyitem_id),
    constraint xpettyitem_xpetty_fk foreign key (xpetty_id) references xpetty (xpetty_id) on delete cascade,
    constraint xpettyitem_xmachine_fk foreign key (xmachine_id) references xmachine (xmachine_id),
    constraint xpettyitem_xsite_fk foreign key (xsite_id) references xsite (xsite_id),
    constraint xpettyitem_xpettycategory_fk foreign key (xpettycategory_id) references xpettycategory (xpettycategory_id)
);

create table xcashdrawn
(
    xcashdrawn_id       int not null generated by default as identity (start with 1),
    cur_date            date not null,
    cash_drawn          decimal(6,2) not null,
    add_monies          decimal(6,2) not null default 0.0,
    notes               text,
    constraint xcashdrawn_pk primary key (xcashdrawn_id)
);
----------------- auxiliary tables -------------------

create view v_userprofile as 
select p.profile_id,
       p.first_name,
       p.last_name,
       p.address1,
       p.address2,
       p.city,
       p.state,
       p.zip_code,
       p.phone as office_phone,
       p.cell_phone,
       u.fax,
       p.email,
       u.webaddress,
       u.office_hours,
       u.salesperson,
       u.manager    
  from profile p, userprofile u
 where u.profile_id = p.profile_id;

create view v_clientprofile as
select p.profile_id,
       p.first_name,
       p.last_name,
       c.birthday,
       p.address1,
       p.address2,
       p.city,
       p.state,
       p.zip_code,
       p.phone as home_phone,
       p.cell_phone,
       p.email,
       c.source_type,
       c.source_descr,
       c.sales_potential
  from profile p, clientprofile c
 where c.profile_id = p.profile_id;

insert into profile(profile_id,first_name,last_name,address1) values(1,'Admin','Adminson','not known');
insert into userprofile(profile_id,salesperson,manager,login,pwdmd5) select profile_id,0,1,'admin','admin' from profile where first_name='Admin';

insert into profile(profile_id,first_name,last_name,address1) values(2,'Salesman','Sale','not known');
insert into userprofile(profile_id,salesperson,manager,login,pwdmd5) select profile_id,1,0,'sale','sale' from profile where first_name='Salesman';
